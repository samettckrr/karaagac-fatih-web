<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Davetiye KartÄ±</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Playfair+Display:wght@500;700&family=Cormorant+Garamond:wght@500;600;700&family=Cinzel:wght@600;700&family=Lora:wght@600;700&family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Playfair Display', 'Cormorant Garamond', 'Georgia', serif;
      background: #e5e5e5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      margin: 0;
    }

    .davetiye-container {
      background-color: #f9f9f9;
      position: relative;
      padding: 50px 30px 50px 30px;
      box-shadow: 
        0 15px 60px rgba(0, 0, 0, 0.22),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
      border-radius: 8px;
      overflow: hidden;
      /* Dikey boyut */
      width: 160mm;
      height: 297mm;
      aspect-ratio: 160 / 297;
      display: flex;
      flex-direction: column;
    }

    /* Arka plan gÃ¶rseli - ayrÄ± bir element olarak */
    .davetiye-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        url('davetiye.png'),
        radial-gradient(circle at 1px 1px, rgba(0, 0, 0, 0.02) 1px, transparent 0);
      background-size: 100% 100%, 30px 30px;
      background-position: 0 0, 0 0;
      background-repeat: no-repeat, repeat;
      z-index: 0;
      pointer-events: none;
    }

    @media screen {
      .davetiye-container {
        max-width: 100%;
        max-height: 90vh;
        aspect-ratio: 160 / 297;
      }
    }

    /* TÃ¼m iÃ§erik Ã¶ÄŸelerinin kenarlÄ±k Ã¼stÃ¼nde gÃ¶rÃ¼nmesi iÃ§in */
    .davetiye-container > *:not(.border-image) {
      position: relative;
      z-index: 2;
    }

    /* Ä°Ã§ border efekti - 10px iÃ§eride */
    .davetiye-container::before {
      content: '';
      position: absolute;
      inset: 10px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 4px;
      pointer-events: none;
      z-index: 1;
    }

    /* KenarlÄ±k gÃ¶rseli */
    .border-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: fill; /* Container'a tam sÄ±ÄŸdÄ±r - kenarlÄ±k gÃ¶rseli container'Ä± tam doldurur */
      pointer-events: none;
      z-index: 1;
    }

    /* Dekoratif Ã¼st eleman - Ã§iÃ§ek gÃ¶rseli */
    .top-decoration {
      text-align: center;
      margin-bottom: 12px;
      position: relative;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    .top-decoration img {
      max-width: 190px;
      max-height: 120px;
      width: auto;
      height: auto;
      object-fit: contain;
      opacity: 0.95;
      filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.15));
    }

    /* AlÄ±cÄ± ismi */
    .recipient-name {
      text-align: center;
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 36px;
      color: #8B4513;
      font-style: italic;
      margin-top: 0;
      margin-bottom: 12px;
      font-weight: 700;
      line-height: 1.25;
      text-shadow: 
        0 2px 4px rgba(139, 69, 19, 0.15),
        0 1px 2px rgba(139, 69, 19, 0.2);
      letter-spacing: 1px;
      position: relative;
      z-index: 2;
      padding: 0 15px;
      word-wrap: break-word;
      max-width: 100%;
    }

    /* Dekoratif ayÄ±rÄ±cÄ± */
    .divider {
      text-align: center;
      margin: 20px 0 0 0;
      font-size: 22px;
      color: #8B6F47;
      opacity: 0.7;
      letter-spacing: 12px;
      font-family: serif;
    }

    /* Hadis-i Åžerif bÃ¶lÃ¼mÃ¼ */
    .hadith-section {
      text-align: center;
      margin: 20px 0 18px 0;
      padding: 0 0px;
      position: relative;
      z-index: 2;
    }

    .hadith-label {
      font-size: 18px;
      color: #6B5530;
      font-weight: 800;
      letter-spacing: 1.5px;
      margin-bottom: 10px;
      font-family: 'Cormorant Garamond', 'Playfair Display', serif;
      text-transform: none;
      opacity: 1;
      text-shadow: 0 1px 2px rgba(107, 85, 48, 0.3);
    }

    .hadith-text {
      font-size: 17px;
      color: #2F4F30;
      line-height: 1.6;
      font-weight: 600;
      letter-spacing: 0.2px;
      font-family: 'Cormorant Garamond', 'Playfair Display', 'Georgia', serif;
      font-style: italic;
      padding: 12px 15px;
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(201, 169, 97, 0.05) 100%);
      border-left: 2px solid #d4af37;
      border-right: 2px solid #d4af37;
      border-radius: 6px;
      max-width: 90%;
      margin: 0 auto;
    }

    /* TeÅŸekkÃ¼r mesajÄ± */
    .thanks-message {
      text-align: center;
      font-size: 22px;
      color: #2F4F30;
      line-height: 1.4;
      margin-bottom: 18px;
      font-weight: 500;
      letter-spacing: 0.3px;
      font-family: 'Cormorant Garamond', 'Playfair Display', 'Georgia', serif;
      font-style: normal;
      padding: 0 0px;
      max-width: 155%;
      margin-left: auto;
      margin-right: auto;
    }

    /* HaftanÄ±n gÃ¼nÃ¼ - daha bÃ¼yÃ¼k, merkez odak noktasÄ± */
    .day-of-week {
      text-align: center;
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 3.25rem;
      color: #8B4513;
      font-style: italic;
      margin: 6px 0 2px 0;
      font-weight: 700;
      text-shadow: 
        0 2px 5px rgba(139, 69, 19, 0.2),
        0 1px 2px rgba(139, 69, 19, 0.25);
      letter-spacing: 1.5px;
      position: relative;
      z-index: 2;
    }

    /* Tarih bÃ¶lÃ¼mÃ¼ - yeniden tasarlandÄ± */
    .date-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 2px 0;
      position: relative;
      z-index: 2;
    }

    /* AltÄ±n Ã§izgi ayÄ±rÄ±cÄ± */
    .gold-line {
      width: 65%;
      height: 1px;
      background: linear-gradient(to right, transparent 10%, #d4af37 30%, #c9a961 50%, #d4af37 70%, transparent 90%);
      margin: 6px 0;
      border: none;
      opacity: 0.75;
    }

    /* Tarih kutularÄ± - yan yana */
    .date-boxes {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin: 2px auto;
      width: 100%;
      max-width: 100%;
    }

    /* Tarih ayÄ±rÄ±cÄ± - Ã§iÃ§ek gÃ¶rseli */
    .date-separator {
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.9;
    }

    .date-separator img {
      width: 28px;
      height: 28px;
      object-fit: contain;
      filter: drop-shadow(0 1px 2px rgba(212, 175, 55, 0.3));
    }

    .date-box {
      text-align: center;
      font-weight: 600;
      font-size: 23px;
      color: #2c3e50;
      letter-spacing: 2px;
      font-family: 'Cinzel', 'Lora', 'Cormorant Garamond', serif;
      padding: 6px 0;
      text-transform: uppercase;
      font-style: normal;
      white-space: nowrap;
    }

    /* YÄ±l kutusu */
    .year-box {
      text-align: center;
      margin: 0px 0;
      padding: 0;
      position: relative;
      z-index: 2;
    }

    .year-text {
      font-size: 16px;
      color: #2c3e50;
      font-weight: 600;
      letter-spacing: 3px;
      font-family: 'Cinzel', 'Lora', 'Cormorant Garamond', serif;
      font-style: normal;
    }

    /* KapanÄ±ÅŸ mesajÄ± */
    .closing-message {
      text-align: center;
      font-family: 'Playfair Display', 'Cormorant Garamond', 'Georgia', serif;
      font-size: 23px;
      color: #2F4F30;
      font-style: italic;
      margin: 15px 0 35px 0;
      min-height: 40px;
      line-height: 1.5;
      font-weight: 600;
      letter-spacing: 0.4px;
      text-shadow: 0 1px 2px rgba(47, 79, 48, 0.15);
      position: relative;
      z-index: 2;
    }

    /* Footer alanÄ± - alt tarafa yapÄ±ÅŸÄ±k */
    .footer-section {
      margin-top: auto;
      padding-top: 0;
      padding-bottom: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    /* Logo */
    .organization-logo {
      text-align: center;
      margin-bottom: 10px;
    }

    .organization-logo img {
      width: 65px;
      height: 65px;
      object-fit: contain;
      opacity: 0.95;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    /* Organizasyon adÄ± */
    .organization-name {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      color: #2F4F30;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0;
      margin-bottom: 0;
      text-shadow: 
        0 2px 4px rgba(47, 79, 48, 0.15),
        0 1px 2px rgba(47, 79, 48, 0.2);
      font-family: 'Quicksand', sans-serif;
    }

  </style>
</head>
<body>
  <div class="davetiye-container" id="davetiyeCard">
    <!-- KenarlÄ±k gÃ¶rseli -->
    <img src="kenarlÄ±k.png" alt="KenarlÄ±k" class="border-image" />

    <!-- Dekoratif Ã¼st eleman - Ã§iÃ§ek gÃ¶rseli -->
    <div class="top-decoration">
      <img src="cicek.png" alt="Ã‡iÃ§ek Dekorasyonu" />
    </div>

    <!-- AlÄ±cÄ± ismi -->
    <div class="recipient-name" id="recipientName">
      Sn. Tunahan Ã–zgan ve Ailesi
    </div>

    <!-- Dekoratif ayÄ±rÄ±cÄ± - desenli Ã§izgi -->
    <hr class="divider" />

    <!-- Hadis-i Åžerif -->
    <div class="hadith-section">
      <div class="hadith-label">Hadis-i Åžerif</div>
      <div class="hadith-text" id="hadithText">
        "Kim, bir oruÃ§luyu iftar ettirirse, Onun ecrinin bir mislide kendisine verilir. OruÃ§lunun sevabÄ±ndan da hiÃ§bir ÅŸey eksilmez."
      </div>
    </div>

    <!-- TeÅŸekkÃ¼r mesajÄ± -->
    <div class="thanks-message" id="thanksMessage">
      KaraaÄŸaÃ§ Fatih Kursumuzda ilim tedrÃ®sÃ¢tÄ±na devam eden talebelerimize iftar ikramlarÄ±nÄ±zdan dolayÄ± teÅŸekkÃ¼r ederiz.
    </div>

    <!-- HaftanÄ±n gÃ¼nÃ¼ -->
    <div class="day-of-week" id="dayOfWeek">
      Cumartesi
    </div>

    <!-- Tarih bÃ¶lÃ¼mÃ¼ - yan yana -->
    <div class="date-section">
      <hr class="gold-line" />
      <div class="date-boxes">
        <div class="date-box" id="gregorianDate">22 MART</div>
        <span class="date-separator"><img src="cicek.png" alt="Ã‡iÃ§ek" /></span>
        <div class="date-box" id="hijriDate">22 RAMAZAN</div>
      </div>
    </div>

    <!-- YÄ±l -->
    <div class="year-box">
      <div class="year-text" id="yearText">
        2025-1446
      </div>
    </div>

    <!-- KapanÄ±ÅŸ mesajÄ± -->
    <div class="closing-message" id="closingMessage">
      Sizleri ve ailenizi Kursumuzda aÄŸÄ±rlamaktan memnuniyet duyarÄ±z.
    </div>

    <!-- Logo -->
    <div class="organization-logo">
      <img src="../img/logo.png" alt="KaraaÄŸaÃ§ Fatih Logo" />
    </div>

    <!-- Organizasyon adÄ± -->
    <div class="organization-name">
      KARAAÄžAÃ‡ FATÄ°H
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Dinamik alanlarÄ± doldurmak iÃ§in fonksiyonlar
    // Container boyutu CSS'te A4 dikey boyutu olarak ayarlanmÄ±ÅŸ

    // Dinamik alanlarÄ± doldurmak iÃ§in placeholder fonksiyonlar
    // Bu fonksiyonlar js/davetiye-karti.js'den Ã§aÄŸrÄ±lacak

    // PNG olarak kaydetme - saÄŸ tÄ±k menÃ¼sÃ¼ (sadece URL parametresi yoksa)
    let davetiyeCard = null;
    
    function setupContextMenu() {
      davetiyeCard = document.getElementById('davetiyeCard');
      if (!davetiyeCard) return;
      
      davetiyeCard.addEventListener('contextmenu', function(e) {
        // URL parametresi varsa saÄŸ tÄ±k menÃ¼sÃ¼nÃ¼ devre dÄ±ÅŸÄ± bÄ±rak (otomatik indirme var)
        if (window.location.search) {
          return;
        }
        
        e.preventDefault();
        
        html2canvas(davetiyeCard, {
          backgroundColor: '#f9f9f9',
          scale: 2,
          logging: false,
          useCORS: true
        }).then(function(canvas) {
          const imgData = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'davetiye-karti.png';
          link.href = imgData;
          link.click();
        });
        
        return false;
      });
    }

    // URL parametrelerini oku ve davetiye kartÄ±nÄ± doldur
    function loadDavetiyeFromURL() {
      const params = new URLSearchParams(window.location.search);
      const sahip = params.get('sahip') || 'Misafir';
      const tip = params.get('tip') || 'iftar';
      const tarihISO = params.get('tarih');
      const gun = params.get('gun') || '';
      const gregGun = params.get('gregGun') || '';
      const gregAy = params.get('gregAy') || '';
      const gregYil = params.get('gregYil') || '';
      const hasFamily = params.get('hasFamily') === 'true';

      if (!tarihISO) {
        console.warn('Tarih parametresi bulunamadÄ±');
        return;
      }

      // Tarihi parse et
      const tarih = new Date(tarihISO);
      if (isNaN(tarih.getTime())) {
        console.error('GeÃ§ersiz tarih:', tarihISO);
        return;
      }

      // Hicri tarih hesaplama (moment-hijri ile)
      let hijriGun = '';
      let hijriAy = '';
      let hijriYil = '';

      // Hicri tarih hesaplama
      if (typeof moment !== 'undefined') {
        try {
          // Moment objesini oluÅŸtur
          const m = moment(tarih);
          
          // Moment-hijri plugin'inin yÃ¼klÃ¼ olup olmadÄ±ÄŸÄ±nÄ± kontrol et
          if (m.format && typeof m.format === 'function') {
            // Hicri formatÄ±nÄ± dene
            const hijriFormat = m.format('iYYYY/iM/iD');
            
            if (hijriFormat && hijriFormat !== 'Invalid date' && hijriFormat.includes('/') && !hijriFormat.includes('NaN')) {
              const hijriParts = hijriFormat.split('/');
              hijriYil = hijriParts[0];
              const hijriAyNum = parseInt(hijriParts[1], 10);
              // Hicri gÃ¼n -1 olarak hesapla
              const hijriGunRaw = parseInt(hijriParts[2], 10);
              
              // NaN kontrolÃ¼
              if (isNaN(hijriAyNum) || isNaN(hijriGunRaw) || isNaN(parseInt(hijriYil, 10))) {
                throw new Error('Hicri tarih parse hatasÄ±: NaN deÄŸer');
              }
              
              hijriGun = Math.max(1, hijriGunRaw - 1).toString();

              // Hicri ay isimleri (TÃ¼rkÃ§e) - 1-based index
              const hicriAylar = ['MUHARREM', 'SAFER', 'REBÄ°ÃœLEVVEL', 'REBÄ°ÃœLAHÄ°R', 'CEMAZÄ°YELEVVEL', 'CEMAZÄ°YELAHÄ°R', 
                                  'RECEB', 'ÅžABAN', 'RAMAZAN', 'ÅžEVVAL', 'ZÄ°LKADE', 'ZÄ°LHÄ°CCE'];
              
              if (hijriAyNum >= 1 && hijriAyNum <= 12) {
                hijriAy = hicriAylar[hijriAyNum - 1];
              } else {
                hijriAy = 'RAMAZAN';
              }
              
              console.log('Hicri tarih (moment-hijri):', {
                gregoryen: tarih.toISOString().split('T')[0],
                hicriFormat: hijriFormat,
                hicriYil: hijriYil,
                hicriAyNum: hijriAyNum,
                hicriAy: hijriAy,
                hicriGun: hijriGun
              });
            } else {
              throw new Error('Moment-hijri format hatasÄ±: ' + hijriFormat);
            }
          } else {
            throw new Error('Moment-hijri plugin yÃ¼klenmemiÅŸ');
          }
        } catch (e) {
          console.error('Hicri tarih hesaplama hatasÄ±:', e);
          // Fallback: Manuel hesaplama (yaklaÅŸÄ±k)
          const gregDate = new Date(tarih);
          const gregYear = gregDate.getFullYear();
          const gregMonth = gregDate.getMonth() + 1;
          const gregDay = gregDate.getDate();
          
          // YaklaÅŸÄ±k hicri yÄ±l hesaplama (daha doÄŸru)
          // Hicri yÄ±l = (Gregoryen yÄ±l - 622) + (Gregoryen yÄ±l - 622) / 33
          const baseDiff = gregYear - 622;
          const adjustment = Math.floor(baseDiff / 33);
          hijriYil = (baseDiff + adjustment).toString();
          
          // GÃ¼n -1 olarak hesapla
          hijriGun = Math.max(1, gregDay - 1).toString();
          hijriAy = 'RAMAZAN'; // VarsayÄ±lan
          
          console.warn('Fallback hicri tarih kullanÄ±ldÄ±:', { hijriYil, hijriGun, hijriAy });
        }
      } else {
        console.warn('Moment kÃ¼tÃ¼phanesi yÃ¼klenemedi, fallback kullanÄ±lÄ±yor');
        // Fallback: Basit hesaplama (yaklaÅŸÄ±k)
        const gregDate = new Date(tarih);
        const gregYear = gregDate.getFullYear();
        const gregDay = gregDate.getDate();
        const baseDiff = gregYear - 622;
        const adjustment = Math.floor(baseDiff / 33);
        hijriYil = (baseDiff + adjustment).toString();
        hijriGun = Math.max(1, gregDay - 1).toString();
        hijriAy = 'RAMAZAN'; // VarsayÄ±lan olarak Ramazan
      }

      // Dinamik alanlarÄ± doldur
      setRecipientName(sahip, hasFamily);
      setThanksMessage(tip);
      setDayOfWeek(gun);
      setGregorianDate(gregGun, gregAy);
      setHijriDate(hijriGun, hijriAy);
      setYear(gregYil, hijriYil);
      setClosingMessage(hasFamily, tip);

      // Otomatik PNG indirme ve sayfa kapatma
      davetiyeCard = document.getElementById('davetiyeCard');
      if (!davetiyeCard) {
        console.error('Davetiye kartÄ± bulunamadÄ±!');
        return;
      }

      setTimeout(() => {
        html2canvas(davetiyeCard, {
          backgroundColor: '#f9f9f9',
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true,
          imageTimeout: 15000,
          width: davetiyeCard.offsetWidth,
          height: davetiyeCard.offsetHeight,
          onclone: function(clonedDoc) {
            // KlonlanmÄ±ÅŸ dokÃ¼manda gÃ¶rsellerin yÃ¼klendiÄŸinden emin ol
            const clonedCard = clonedDoc.getElementById('davetiyeCard');
            if (clonedCard) {
              // Arka plan gÃ¶rselinin yÃ¼klendiÄŸinden emin ol
              const style = clonedDoc.defaultView.getComputedStyle(clonedCard);
              const bgImage = style.backgroundImage;
              
              const imgs = clonedCard.querySelectorAll('img');
              imgs.forEach(img => {
                if (!img.complete) {
                  img.src = img.src; // Yeniden yÃ¼kle
                }
              });
            }
          }
        }).then(function(canvas) {
          const imgData = canvas.toDataURL('image/png');
          
          // Mobil cihaz kontrolÃ¼
          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
          
          if (isMobile) {
            // Mobil cihazlarda: Canvas'Ä± sayfada gÃ¶ster ve kullanÄ±cÄ±nÄ±n uzun basarak kaydetmesine izin ver
            const img = document.createElement('img');
            img.src = imgData;
            img.style.width = '100%';
            img.style.height = 'auto';
            img.style.display = 'block';
            img.style.margin = '0 auto';
            img.style.maxWidth = '100%';
            
            // Mevcut iÃ§eriÄŸi temizle ve sadece gÃ¶rseli gÃ¶ster
            document.body.innerHTML = '';
            document.body.style.padding = '20px';
            document.body.style.backgroundColor = '#f5f5f5';
            document.body.style.textAlign = 'center';
            
            const info = document.createElement('div');
            info.style.marginTop = '20px';
            info.style.padding = '15px';
            info.style.backgroundColor = '#fff';
            info.style.borderRadius = '8px';
            info.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
            info.innerHTML = isIOS 
              ? '<p style="margin:0; color:#333; font-size:16px;">ðŸ“± GÃ¶rsele uzun basÄ±n ve "FotoÄŸrafÄ± Kaydet" seÃ§eneÄŸini seÃ§in</p>'
              : '<p style="margin:0; color:#333; font-size:16px;">ðŸ“± GÃ¶rsele uzun basÄ±n ve "Resmi Kaydet" veya "GÃ¶rseli Ä°ndir" seÃ§eneÄŸini seÃ§in</p>';
            
            document.body.appendChild(img);
            document.body.appendChild(info);
            
            // iOS'ta sayfayÄ± kapatma
            if (!isIOS) {
              setTimeout(() => {
                try {
                  window.close();
                } catch (e) {
                  // Sayfa kapatÄ±lamazsa sessizce devam et
                }
              }, 2000);
            }
          } else {
            // MasaÃ¼stÃ¼: Otomatik indirme
            const link = document.createElement('a');
            const fileName = `davetiye-${sahip.replace(/\s+/g, '-')}-${tip}-${gregGun}-${gregAy.toLowerCase()}.png`;
            link.download = fileName;
            link.href = imgData;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // SayfayÄ± kapat
            setTimeout(() => {
              try {
                window.close();
              } catch (e) {
                // Sayfa kapatÄ±lamazsa sessizce devam et
              }
            }, 500);
          }
        }).catch(function(error) {
          console.error('PNG oluÅŸturma hatasÄ±:', error);
          const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          const errorMsg = isMobile 
            ? 'Davetiye gÃ¶rseli oluÅŸturulamadÄ±. LÃ¼tfen sayfaya uzun basÄ±p "GÃ¶rseli Kaydet" seÃ§eneÄŸini kullanÄ±n.'
            : 'Davetiye gÃ¶rseli oluÅŸturulamadÄ±. LÃ¼tfen sayfaya saÄŸ tÄ±klayÄ±p "GÃ¶rseli farklÄ± kaydet" seÃ§eneÄŸini kullanÄ±n.';
          alert(errorMsg);
        });
      }, 1500); // Sayfa yÃ¼klendikten 1.5 saniye sonra indir
    }

    // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
    document.addEventListener('DOMContentLoaded', function() {
      setupContextMenu();
      
      // URL parametreleri varsa otomatik doldur ve indir
      if (window.location.search) {
        // GÃ¶rsellerin yÃ¼klenmesini bekle
        const images = document.querySelectorAll('img');
        let loadedImages = 0;
        const totalImages = images.length;
        
        if (totalImages === 0) {
          // GÃ¶rsel yoksa direkt yÃ¼kle
          setTimeout(() => loadDavetiyeFromURL(), 500);
        } else {
          images.forEach(img => {
            if (img.complete) {
              loadedImages++;
            } else {
              img.addEventListener('load', () => {
                loadedImages++;
                if (loadedImages === totalImages) {
                  setTimeout(() => loadDavetiyeFromURL(), 500);
                }
              });
              img.addEventListener('error', () => {
                loadedImages++;
                if (loadedImages === totalImages) {
                  setTimeout(() => loadDavetiyeFromURL(), 500);
                }
              });
            }
          });
          
          // TÃ¼m gÃ¶rseller yÃ¼klendiyse
          if (loadedImages === totalImages) {
            setTimeout(() => loadDavetiyeFromURL(), 500);
          }
          
          // Maksimum 5 saniye bekle
          setTimeout(() => {
            if (loadedImages < totalImages) {
              console.warn('BazÄ± gÃ¶rseller yÃ¼klenemedi, devam ediliyor...');
              loadDavetiyeFromURL();
            }
          }, 5000);
        }
      }
    });

    function setRecipientName(name, hasFamily) {
      const element = document.getElementById('recipientName');
      if (element && name) {
        // Her zaman "ve Ailesi" eklenecek
        element.textContent = `Sn. ${name} ve Ailesi`;
      } else {
        console.warn('setRecipientName: element veya name eksik', { name });
      }
    }

    function setThanksMessage(tip) {
      const element = document.getElementById('thanksMessage');
      if (element && tip) {
        const messageType = tip === 'iftar' ? 'iftar' : 'sahur';
        element.textContent = `KaraaÄŸaÃ§ Fatih Kursumuzda ilim tedrÃ®sÃ¢tÄ±na devam eden talebelerimize ${messageType} ikramlarÄ±nÄ±zdan dolayÄ± teÅŸekkÃ¼r ederiz.`;
      } else {
        console.warn('setThanksMessage: element veya tip eksik', { tip });
      }
    }

    function setDayOfWeek(dayName) {
      const element = document.getElementById('dayOfWeek');
      if (element && dayName) {
        element.textContent = dayName;
      } else {
        console.warn('setDayOfWeek: element veya dayName eksik', { dayName });
      }
    }

    function setGregorianDate(day, month) {
      const element = document.getElementById('gregorianDate');
      if (element && day && month) {
        element.textContent = `${day} ${month.toUpperCase()}`;
      } else {
        console.warn('setGregorianDate: element veya parametre eksik', { day, month });
      }
    }

    function setHijriDate(day, month) {
      const element = document.getElementById('hijriDate');
      if (element && day && month) {
        element.textContent = `${day} ${month.toUpperCase()}`;
      } else {
        console.warn('setHijriDate: element veya parametre eksik', { day, month });
      }
    }

    function setYear(gregorianYear, hijriYear) {
      const element = document.getElementById('yearText');
      if (element && gregorianYear && hijriYear) {
        element.textContent = `${gregorianYear}-${hijriYear}`;
      } else {
        console.warn('setYear: element veya parametre eksik', { gregorianYear, hijriYear });
      }
    }

    function setClosingMessage(hasFamily, tip) {
      const element = document.getElementById('closingMessage');
      // Sahur davetiyesinde bu mesaj boÅŸ kalacak
      if (tip === 'sahur') {
        element.textContent = '';
      } else {
        // Ä°ftar davetiyesinde her zaman "ve ailenizi" ile
        element.textContent = 'Sizleri ve ailenizi Kursumuzda aÄŸÄ±rlamaktan memnuniyet duyarÄ±z.';
      }
    }
  </script>
</body>
</html>

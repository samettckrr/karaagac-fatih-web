<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=650, user-scalable=no">
  <title>Davetiye Kartı</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Playfair+Display:wght@500;700&family=Cormorant+Garamond:wght@500;600;700&family=Cinzel:wght@600;700&family=Lora:wght@600;700&family=Quicksand:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/moment-hijri.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Playfair Display', 'Cormorant Garamond', 'Georgia', serif;
      background: #e5e5e5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      margin: 0;
    }

    .davetiye-container {
    background-color: #f9f9f9;
    position: relative;
    padding: 30px 40px; /* Padding'i biraz kıstık */
    box-shadow: 
      0 15px 60px rgba(0, 0, 0, 0.22),
      inset 0 1px 0 rgba(255, 255, 255, 0.6);
    border-radius: 8px;
    overflow: hidden;
    
    /* YENİ SABİT PİKSEL BOYUTLAR (Oran Korundu) */
    /* Bu boyutlar ekranda rahat görünür, scroll gerektirmez */
    width: 650px;
    height: 880px;
    
    /* Esnemeyi Engelle */
    min-width: 650px;
    min-height: 880px;
    flex-shrink: 0;
    
    display: flex;
    flex-direction: column;
  }

    /* Arka plan görseli - ayrı bir element olarak */
    .davetiye-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        url('davetiye.png'),
        radial-gradient(circle at 1px 1px, rgba(0, 0, 0, 0.02) 1px, transparent 0);
      background-size: 100% 100%, 30px 30px;
      background-position: 0 0, 0 0;
      background-repeat: no-repeat, repeat;
      z-index: 0;
      pointer-events: none;
    }

    /* Tüm içerik öğelerinin kenarlık üstünde görünmesi için */
    .davetiye-container > *:not(.border-image) {
      position: relative;
      z-index: 2;
    }

    /* İç border efekti - 10px içeride */
    .davetiye-container::before {
      content: '';
      position: absolute;
      inset: 10px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 4px;
      pointer-events: none;
      z-index: 1;
    }

    /* Kenarlık görseli */
    .border-image {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: fill; /* Container'a tam sığdır - kenarlık görseli container'ı tam doldurur */
      pointer-events: none;
      z-index: 1;
    }

    /* Dekoratif üst eleman - çiçek görseli */
    .top-decoration {
      text-align: center;
      margin-bottom: 12px;
      position: relative;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    .top-decoration img {
      max-width: 190px;
      max-height: 120px;
      width: auto;
      height: auto;
      object-fit: contain;
      opacity: 0.95;
      filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.15));
    }

    /* Alıcı ismi */
    .recipient-name {
      text-align: center;
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 36px;
      color: #8B4513;
      font-style: italic;
      margin-top: 0;
      margin-bottom: 12px;
      font-weight: 700;
      line-height: 1.25;
      text-shadow: 
        0 2px 4px rgba(139, 69, 19, 0.15),
        0 1px 2px rgba(139, 69, 19, 0.2);
      letter-spacing: 1px;
      position: relative;
      z-index: 2;
      padding: 0 15px;
      word-wrap: break-word;
      max-width: 100%;
    }

    /* Dekoratif ayırıcı */
    .divider {
      text-align: center;
      margin: 20px 0 0 0;
      font-size: 22px;
      color: #8B6F47;
      opacity: 0.7;
      letter-spacing: 12px;
      font-family: serif;
    }

    /* Hadis-i Şerif bölümü */
    .hadith-section {
      text-align: center;
      margin: 20px 0 18px 0;
      padding: 0 0px;
      position: relative;
      z-index: 2;
    }

    .hadith-label {
      font-size: 18px;
      color: #6B5530;
      font-weight: 800;
      letter-spacing: 1.5px;
      margin-bottom: 10px;
      font-family: 'Cormorant Garamond', 'Playfair Display', serif;
      text-transform: none;
      opacity: 1;
      text-shadow: 0 1px 2px rgba(107, 85, 48, 0.3);
    }

    .hadith-text {
      font-size: 17px;
      color: #2F4F30;
      line-height: 1.6;
      font-weight: 600;
      letter-spacing: 0.2px;
      font-family: 'Cormorant Garamond', 'Playfair Display', 'Georgia', serif;
      font-style: italic;
      padding: 12px 15px;
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.08) 0%, rgba(201, 169, 97, 0.05) 100%);
      border-left: 2px solid #d4af37;
      border-right: 2px solid #d4af37;
      border-radius: 6px;
      max-width: 90%;
      margin: 0 auto;
    }

    /* Teşekkür mesajı */
    .thanks-message {
      text-align: center;
      font-size: 22px;
      color: #2F4F30;
      line-height: 1.4;
      margin-bottom: 18px;
      font-weight: 500;
      letter-spacing: 0.3px;
      font-family: 'Cormorant Garamond', 'Playfair Display', 'Georgia', serif;
      font-style: normal;
      padding: 0 0px;
      max-width: 155%;
      margin-left: auto;
      margin-right: auto;
    }

    /* Haftanın günü - daha büyük, merkez odak noktası */
    .day-of-week {
      text-align: center;
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 3.25rem;
      color: #8B4513;
      font-style: italic;
      margin: 6px 0 2px 0;
      font-weight: 700;
      text-shadow: 
        0 2px 5px rgba(139, 69, 19, 0.2),
        0 1px 2px rgba(139, 69, 19, 0.25);
      letter-spacing: 1.5px;
      position: relative;
      z-index: 2;
    }

    /* Tarih bölümü - yeniden tasarlandı */
    .date-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 2px 0;
      position: relative;
      z-index: 2;
    }

    /* Altın çizgi ayırıcı */
    .gold-line {
      width: 65%;
      height: 1px;
      background: linear-gradient(to right, transparent 10%, #d4af37 30%, #c9a961 50%, #d4af37 70%, transparent 90%);
      margin: 6px 0;
      border: none;
      opacity: 0.75;
    }

    /* Tarih kutuları - yan yana */
    .date-boxes {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin: 2px auto;
      width: 100%;
      max-width: 100%;
    }

    /* Tarih ayırıcı - çiçek görseli */
    .date-separator {
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.9;
    }

    .date-separator img {
      width: 28px;
      height: 28px;
      object-fit: contain;
      filter: drop-shadow(0 1px 2px rgba(212, 175, 55, 0.3));
    }

    .date-box {
      text-align: center;
      font-weight: 600;
      font-size: 23px;
      color: #2c3e50;
      letter-spacing: 2px;
      font-family: 'Cinzel', 'Lora', 'Cormorant Garamond', serif;
      padding: 6px 0;
      text-transform: uppercase;
      font-style: normal;
      white-space: nowrap;
    }

    /* Yıl kutusu */
    .year-box {
      text-align: center;
      margin: 0px 0;
      padding: 0;
      position: relative;
      z-index: 2;
    }

    .year-text {
      font-size: 16px;
      color: #2c3e50;
      font-weight: 600;
      letter-spacing: 3px;
      font-family: 'Cinzel', 'Lora', 'Cormorant Garamond', serif;
      font-style: normal;
    }

    /* Kapanış mesajı */
    .closing-message {
      text-align: center;
      font-family: 'Playfair Display', 'Cormorant Garamond', 'Georgia', serif;
      font-size: 23px;
      color: #2F4F30;
      font-style: italic;
      margin: 15px 0 35px 0;
      min-height: 40px;
      line-height: 1.5;
      font-weight: 600;
      letter-spacing: 0.4px;
      text-shadow: 0 1px 2px rgba(47, 79, 48, 0.15);
      position: relative;
      z-index: 2;
    }

    /* Footer alanı - alt tarafa yapışık */
    .footer-section {
      margin-top: auto;
      padding-top: 0;
      padding-bottom: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    /* Logo */
    .organization-logo {
      text-align: center;
      margin-bottom: 10px;
    }

    .organization-logo img {
      width: 65px;
      height: 65px;
      object-fit: contain;
      opacity: 0.95;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    /* Organizasyon adı */
    .organization-name {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      color: #2F4F30;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0;
      margin-bottom: 0;
      text-shadow: 
        0 2px 4px rgba(47, 79, 48, 0.15),
        0 1px 2px rgba(47, 79, 48, 0.2);
      font-family: 'Quicksand', sans-serif;
    }

  </style>
</head>
<body>
  <div class="davetiye-container" id="davetiyeCard">
    <!-- Kenarlık görseli -->
    <img src="kenarlık.png" alt="Kenarlık" class="border-image" />

    <!-- Dekoratif üst eleman - çiçek görseli -->
    <div class="top-decoration">
      <img src="cicek.png" alt="Çiçek Dekorasyonu" />
    </div>

    <!-- Alıcı ismi -->
    <div class="recipient-name" id="recipientName">
      Sn. Tunahan Özgan ve Ailesi
    </div>

    <!-- Dekoratif ayırıcı - desenli çizgi -->
    <hr class="divider" />

    <!-- Hadis-i Şerif -->
    <div class="hadith-section">
      <div class="hadith-label">Hadis-i Şerif</div>
      <div class="hadith-text" id="hadithText">
        "Kim, bir oruçluyu iftar ettirirse, Onun ecrinin bir mislide kendisine verilir. Oruçlunun sevabından da hiçbir şey eksilmez."
      </div>
    </div>

    <!-- Teşekkür mesajı -->
    <div class="thanks-message" id="thanksMessage">
      Karaağaç Fatih Kursumuzda ilim tedrîsâtına devam eden talebelerimize iftar ikramlarınızdan dolayı teşekkür ederiz.
    </div>

    <!-- Haftanın günü -->
    <div class="day-of-week" id="dayOfWeek">
      Cumartesi
    </div>

    <!-- Tarih bölümü - yan yana -->
    <div class="date-section">
      <hr class="gold-line" />
      <div class="date-boxes">
        <div class="date-box" id="gregorianDate">22 MART</div>
        <span class="date-separator"><img src="cicek.png" alt="Çiçek" /></span>
        <div class="date-box" id="hijriDate">22 RAMAZAN</div>
      </div>
    </div>

    <!-- Yıl -->
    <div class="year-box">
      <div class="year-text" id="yearText">
        2025-1446
      </div>
    </div>

    <!-- Kapanış mesajı -->
    <div class="closing-message" id="closingMessage">
      Sizleri ve ailenizi Kursumuzda ağırlamaktan memnuniyet duyarız.
    </div>

    <!-- Logo -->
    <div class="organization-logo">
      <img src="../img/logo.png" alt="Karaağaç Fatih Logo" />
    </div>

    <!-- Organizasyon adı -->
    <div class="organization-name">
      KARAAĞAÇ FATİH
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Dinamik alanları doldurmak için fonksiyonlar
    // Container boyutu CSS'te A4 dikey boyutu olarak ayarlanmış

    // Dinamik alanları doldurmak için placeholder fonksiyonlar
    // Bu fonksiyonlar js/davetiye-karti.js'den çağrılacak

    // PNG olarak kaydetme - sağ tık menüsü (sadece URL parametresi yoksa)
    let davetiyeCard = null;
    
    function setupContextMenu() {
      davetiyeCard = document.getElementById('davetiyeCard');
      if (!davetiyeCard) return;
      
      davetiyeCard.addEventListener('contextmenu', function(e) {
        // URL parametresi varsa sağ tık menüsünü devre dışı bırak (otomatik indirme var)
        if (window.location.search) {
          return;
        }
        
        e.preventDefault();
        
        html2canvas(davetiyeCard, {
          backgroundColor: '#f9f9f9',
          scale: 2,
          logging: false,
          useCORS: true
        }).then(function(canvas) {
          const imgData = canvas.toDataURL('image/png');
          const link = document.createElement('a');
          link.download = 'davetiye-karti.png';
          link.href = imgData;
          link.click();
        });
        
        return false;
      });
    }

    // URL parametrelerini oku ve davetiye kartını doldur
    function loadDavetiyeFromURL() {
      const params = new URLSearchParams(window.location.search);
      const sahip = params.get('sahip') || 'Misafir';
      const tip = params.get('tip') || 'iftar';
      const tarihISO = params.get('tarih');
      const gun = params.get('gun') || '';
      const gregGun = params.get('gregGun') || '';
      const gregAy = params.get('gregAy') || '';
      const gregYil = params.get('gregYil') || '';
      const hasFamily = params.get('hasFamily') === 'true';

      if (!tarihISO) {
        console.warn('Tarih parametresi bulunamadı');
        return;
      }

      // Tarihi parse et
      const tarih = new Date(tarihISO);
      if (isNaN(tarih.getTime())) {
        console.error('Geçersiz tarih:', tarihISO);
        return;
      }

      // Hicri tarih hesaplama (moment-hijri ile)
      let hijriGun = '';
      let hijriAy = '';
      let hijriYil = '';

      // Hicri tarih hesaplama
      if (typeof moment !== 'undefined') {
        try {
          // Moment objesini oluştur
          const m = moment(tarih);
          
          // Moment-hijri plugin'inin yüklü olup olmadığını kontrol et
          if (m.format && typeof m.format === 'function') {
            // Hicri formatını dene
            const hijriFormat = m.format('iYYYY/iM/iD');
            
            if (hijriFormat && hijriFormat !== 'Invalid date' && hijriFormat.includes('/') && !hijriFormat.includes('NaN')) {
              const hijriParts = hijriFormat.split('/');
              hijriYil = hijriParts[0];
              const hijriAyNum = parseInt(hijriParts[1], 10);
              // Hicri gün -1 olarak hesapla
              const hijriGunRaw = parseInt(hijriParts[2], 10);
              
              // NaN kontrolü
              if (isNaN(hijriAyNum) || isNaN(hijriGunRaw) || isNaN(parseInt(hijriYil, 10))) {
                throw new Error('Hicri tarih parse hatası: NaN değer');
              }
              
              hijriGun = Math.max(1, hijriGunRaw - 1).toString();

              // Hicri ay isimleri (Türkçe) - 1-based index
              const hicriAylar = ['MUHARREM', 'SAFER', 'REBİÜLEVVEL', 'REBİÜLAHİR', 'CEMAZİYELEVVEL', 'CEMAZİYELAHİR', 
                                  'RECEB', 'ŞABAN', 'RAMAZAN', 'ŞEVVAL', 'ZİLKADE', 'ZİLHİCCE'];
              
              if (hijriAyNum >= 1 && hijriAyNum <= 12) {
                hijriAy = hicriAylar[hijriAyNum - 1];
              } else {
                hijriAy = 'RAMAZAN';
              }
              
              console.log('Hicri tarih (moment-hijri):', {
                gregoryen: tarih.toISOString().split('T')[0],
                hicriFormat: hijriFormat,
                hicriYil: hijriYil,
                hicriAyNum: hijriAyNum,
                hicriAy: hijriAy,
                hicriGun: hijriGun
              });
            } else {
              throw new Error('Moment-hijri format hatası: ' + hijriFormat);
            }
          } else {
            throw new Error('Moment-hijri plugin yüklenmemiş');
          }
        } catch (e) {
          console.error('Hicri tarih hesaplama hatası:', e);
          // Fallback: Manuel hesaplama (yaklaşık)
          const gregDate = new Date(tarih);
          const gregYear = gregDate.getFullYear();
          const gregMonth = gregDate.getMonth() + 1;
          const gregDay = gregDate.getDate();
          
          // Yaklaşık hicri yıl hesaplama (daha doğru)
          // Hicri yıl = (Gregoryen yıl - 622) + (Gregoryen yıl - 622) / 33
          const baseDiff = gregYear - 622;
          const adjustment = Math.floor(baseDiff / 33);
          hijriYil = (baseDiff + adjustment).toString();
          
          // Gün -1 olarak hesapla
          hijriGun = Math.max(1, gregDay - 1).toString();
          hijriAy = 'RAMAZAN'; // Varsayılan
          
          console.warn('Fallback hicri tarih kullanıldı:', { hijriYil, hijriGun, hijriAy });
        }
      } else {
        console.warn('Moment kütüphanesi yüklenemedi, fallback kullanılıyor');
        // Fallback: Basit hesaplama (yaklaşık)
        const gregDate = new Date(tarih);
        const gregYear = gregDate.getFullYear();
        const gregDay = gregDate.getDate();
        const baseDiff = gregYear - 622;
        const adjustment = Math.floor(baseDiff / 33);
        hijriYil = (baseDiff + adjustment).toString();
        hijriGun = Math.max(1, gregDay - 1).toString();
        hijriAy = 'RAMAZAN'; // Varsayılan olarak Ramazan
      }

      // Dinamik alanları doldur
      setRecipientName(sahip, hasFamily);
      setThanksMessage(tip);
      setDayOfWeek(gun);
      setGregorianDate(gregGun, gregAy);
      setHijriDate(hijriGun, hijriAy);
      setYear(gregYil, hijriYil);
      setClosingMessage(hasFamily, tip);

      // Otomatik PNG indirme ve sayfa kapatma
      davetiyeCard = document.getElementById('davetiyeCard');
      if (!davetiyeCard) {
        console.error('Davetiye kartı bulunamadı!');
        return;
      }

      setTimeout(() => {
        html2canvas(davetiyeCard, {
        backgroundColor: '#f9f9f9',
        scale: 3,             // DİKKAT: Kaliteyi 2'den 3'e çıkardık (Çünkü kartı küçülttük)
        logging: false,
        useCORS: true,
        allowTaint: true,
        imageTimeout: 15000,
        
        // Window ayarları (Sabit tutuyoruz)
        windowWidth: 1920,
        windowHeight: 1080,
        scrollX: 0,
        scrollY: 0,
        x: 0,
        y: 0,
        width: davetiyeCard.offsetWidth,
        height: davetiyeCard.offsetHeight,
          onclone: function(clonedDoc) {
            // Klonlanmış dokümanda görsellerin yüklendiğinden emin ol
            const clonedCard = clonedDoc.getElementById('davetiyeCard');
            if (clonedCard) {
              // Arka plan görselinin yüklendiğinden emin ol
              const style = clonedDoc.defaultView.getComputedStyle(clonedCard);
              const bgImage = style.backgroundImage;
              
              const imgs = clonedCard.querySelectorAll('img');
              imgs.forEach(img => {
                if (!img.complete) {
                  img.src = img.src; // Yeniden yükle
                }
              });
            }
          }
          
        }).then(function(canvas) {
        const imgData = canvas.toDataURL('image/png');
        
        // Dosya ismini oluştur
        const safeSahip = sahip.replace(/[^a-z0-9ğüşıöçĞÜŞİÖÇ\s]/gi, '').replace(/\s+/g, '-');
        const fileName = `davetiye-${safeSahip}-${tip}-${gregGun}-${gregAy.toLowerCase()}.png`;

        // iOS Kontrolü
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

        const downloadAction = () => {
          const link = document.createElement('a');
          link.download = fileName;
          link.href = imgData;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          // İndirme işleminden sonra kapat
          setTimeout(() => {
            try { window.close(); } catch (e) {}
            try { if (window.history.length > 1) window.history.back(); } catch (e) {}
          }, 1000);
        };

        if (isIOS) {
          // iOS İÇİN ÖZEL ÇÖZÜM: Tıklanabilir Buton Oluştur
          // Mevcut içeriği temizle
          document.body.innerHTML = '';
          document.body.style.backgroundColor = 'rgba(0,0,0,0.8)';
          document.body.style.display = 'flex';
          document.body.style.flexDirection = 'column';
          document.body.style.justifyContent = 'center';
          document.body.style.alignItems = 'center';

          // Bilgi Mesajı
          const msg = document.createElement('div');
          msg.innerHTML = "Davetiyeniz Hazırlandı!<br>İndirmek için aşağıdaki butona basınız.";
          msg.style.color = '#fff';
          msg.style.textAlign = 'center';
          msg.style.fontFamily = 'sans-serif';
          msg.style.fontSize = '18px';
          msg.style.marginBottom = '20px';
          document.body.appendChild(msg);

          // Büyük İndirme Butonu
          const btn = document.createElement('button');
          btn.innerText = "DAVETİYEYİ İNDİR ⬇️";
          btn.style.padding = '20px 40px';
          btn.style.fontSize = '20px';
          btn.style.fontWeight = 'bold';
          btn.style.backgroundColor = '#d4af37'; // Altın rengi
          btn.style.color = '#fff';
          btn.style.border = 'none';
          btn.style.borderRadius = '10px';
          btn.style.cursor = 'pointer';
          btn.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
          
          btn.onclick = function() {
            downloadAction();
            btn.innerText = "İndiriliyor...";
            btn.disabled = true;
          };
          
          document.body.appendChild(btn);
          
          // Görsel önizlemesini de ekleyelim ki kullanıcı ne indirdiğini görsün
          const previewImg = document.createElement('img');
          previewImg.src = imgData;
          previewImg.style.marginTop = '20px';
          previewImg.style.maxWidth = '80%';
          previewImg.style.borderRadius = '8px';
          previewImg.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';
          document.body.appendChild(previewImg);

        } else {
          // MASAÜSTÜ ve ANDROID İÇİN: Otomatik İndir
          downloadAction();
        }

      }).catch(function(error) {
        console.error('PNG oluşturma hatası:', error);
        alert('Davetiye oluşturulurken bir hata oluştu.');
      });
      }, 1500); // Sayfa yüklendikten 1.5 saniye sonra indir
    }

    // Sayfa yüklendiğinde çalıştır
    document.addEventListener('DOMContentLoaded', function() {
      setupContextMenu();
      
      // URL parametreleri varsa otomatik doldur ve indir
      if (window.location.search) {
        // Görsellerin yüklenmesini bekle
        const images = document.querySelectorAll('img');
        let loadedImages = 0;
        const totalImages = images.length;
        
        if (totalImages === 0) {
          // Görsel yoksa direkt yükle
          setTimeout(() => loadDavetiyeFromURL(), 500);
        } else {
          images.forEach(img => {
            if (img.complete) {
              loadedImages++;
            } else {
              img.addEventListener('load', () => {
                loadedImages++;
                if (loadedImages === totalImages) {
                  setTimeout(() => loadDavetiyeFromURL(), 500);
                }
              });
              img.addEventListener('error', () => {
                loadedImages++;
                if (loadedImages === totalImages) {
                  setTimeout(() => loadDavetiyeFromURL(), 500);
                }
              });
            }
          });
          
          // Tüm görseller yüklendiyse
          if (loadedImages === totalImages) {
            setTimeout(() => loadDavetiyeFromURL(), 500);
          }
          
          // Maksimum 5 saniye bekle
          setTimeout(() => {
            if (loadedImages < totalImages) {
              console.warn('Bazı görseller yüklenemedi, devam ediliyor...');
              loadDavetiyeFromURL();
            }
          }, 5000);
        }
      }
    });

    function setRecipientName(name, hasFamily) {
      const element = document.getElementById('recipientName');
      if (element && name) {
        // Her zaman "ve Ailesi" eklenecek
        element.textContent = `Sn. ${name} ve Ailesi`;
      } else {
        console.warn('setRecipientName: element veya name eksik', { name });
      }
    }

    function setThanksMessage(tip) {
      const element = document.getElementById('thanksMessage');
      if (element && tip) {
        const messageType = tip === 'iftar' ? 'iftar' : 'sahur';
        element.textContent = `Karaağaç Fatih Kursumuzda ilim tedrîsâtına devam eden talebelerimize ${messageType} ikramlarınızdan dolayı teşekkür ederiz.`;
      } else {
        console.warn('setThanksMessage: element veya tip eksik', { tip });
      }
    }

    function setDayOfWeek(dayName) {
      const element = document.getElementById('dayOfWeek');
      if (element && dayName) {
        element.textContent = dayName;
      } else {
        console.warn('setDayOfWeek: element veya dayName eksik', { dayName });
      }
    }

    function setGregorianDate(day, month) {
      const element = document.getElementById('gregorianDate');
      if (element && day && month) {
        element.textContent = `${day} ${month.toUpperCase()}`;
      } else {
        console.warn('setGregorianDate: element veya parametre eksik', { day, month });
      }
    }

    function setHijriDate(day, month) {
      const element = document.getElementById('hijriDate');
      if (element && day && month) {
        element.textContent = `${day} ${month.toUpperCase()}`;
      } else {
        console.warn('setHijriDate: element veya parametre eksik', { day, month });
      }
    }

    function setYear(gregorianYear, hijriYear) {
      const element = document.getElementById('yearText');
      if (element && gregorianYear && hijriYear) {
        element.textContent = `${gregorianYear}-${hijriYear}`;
      } else {
        console.warn('setYear: element veya parametre eksik', { gregorianYear, hijriYear });
      }
    }

    function setClosingMessage(hasFamily, tip) {
      const element = document.getElementById('closingMessage');
      // Sahur davetiyesinde bu mesaj boş kalacak
      if (tip === 'sahur') {
        element.textContent = '';
      } else {
        // İftar davetiyesinde her zaman "ve ailenizi" ile
        element.textContent = 'Sizleri ve ailenizi Kursumuzda ağırlamaktan memnuniyet duyarız.';
      }
    }
  </script>
</body>
</html>

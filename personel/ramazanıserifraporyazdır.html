<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Personel Raporu | Ramazan 2026</title>
  <link rel="icon" type="image/png" href="../img/logo.png" />

  <style>
    /* --- TEMEL AYARLAR --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Arial, sans-serif; color: #2c3e50; background: #fff; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    @media print {
      @page { size: A4 portrait; margin: 5mm 8mm; }
      body { padding: 0; font-size: 10pt; }
      .page-break { page-break-after: always; height: 0; display: block; }
      h2, h3, .charts-section, .cover-bottom-bar, .analysis-row, .op-section { page-break-after: avoid; }
      tr { page-break-inside: avoid; }
      thead { display: table-header-group; }
      a[href]:after { content: none !important; }
    }

    /* --- CSS STILLERI (√ñncekilerle Aynƒ±) --- */
    .cover-page { width: 100%; height: 285mm; display: flex; flex-direction: column; justify-content: space-between; padding: 15mm; text-align: center; border: 4px solid #324960; background: white; position: relative; }
    .cover-personel-name { font-size: 40px; font-weight: 900; color: #324960; margin: 10px 0 20px 0; text-transform: uppercase; letter-spacing: 1px; }
    .kpi-row { display: flex; gap: 15px; margin: 10px 0; justify-content: center; }
    .kpi { padding: 10px 15px; background: #f4f6f9; border: 1px solid #e6ebf2; border-radius: 8px; min-width: 110px; flex: 1; }
    .kpi .label { font-size: 11px; color: #666; font-weight: bold; }
    .kpi .value { font-size: 20px; font-weight: 800; color: #324960; margin-top: 4px; }
    .charts-section { margin-top: 15px; display: flex; flex-direction: column; gap: 15px; align-items: center; }
    .chart-box { width: 100%; max-width: 600px; border: 1px solid #eee; border-radius: 8px; padding: 10px; position: relative; }
    .chart-title { font-size: 11px; font-weight: 700; color: #324960; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; text-align: left; border-bottom: 1px solid #eee; padding-bottom: 5px; }
    .portfolio-explanation { font-size: 9px; color: #666; text-align: center; margin-top: 8px; line-height: 1.4; font-style: italic; }
    .chart-area { fill: url(#gradientFill); opacity: 0.15; }
    .chart-line { fill: none; stroke: #324960; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    .chart-point { fill: #fff; stroke: #324960; stroke-width: 2.5; }
    .growth-bg { fill: #27ae60; rx: 3; } .growth-bg.negative { fill: #c0392b; }
    .growth-badge { font-size: 10px; font-weight: bold; fill: #fff; }
    .bar-bg { fill: #f0f2f5; rx: 4; } .bar-fill { rx: 4; } .bar-text { font-size: 10px; font-weight: 600; fill: #555; } .bar-count { font-size: 11px; font-weight: bold; fill: #324960; text-anchor: end; }
    .cover-bottom-section { margin-top: auto; }
    .cover-text-container { margin-bottom: 25px; } 
    .cover-main-text { font-size: 18px; font-weight: 800; color: #324960; margin-bottom: 5px; }
    .cover-year-text { font-size: 13px; color: #555; }
    .cover-bottom-bar { border-top: 2px dashed #324960; padding-top: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; }
    .cover-logo-small { height: 40px; width: auto; }
    .cover-bottom-title { font-size: 20px; font-weight: 900; color: #324960; letter-spacing: 1px; }

    /* Sayfa 2-3-4 Stilleri */
    .summary-page { padding: 10mm 0; }
    .page-title { font-size: 18px; font-weight: 800; color: #324960; border-bottom: 2px solid #324960; padding-bottom: 8px; margin-bottom: 15px; }
    .year-box { border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px; break-inside: avoid; }
    .year-header { background: #f0f0f0; padding: 6px 10px; font-weight: bold; color: #333; font-size: 12px; border-bottom: 1px solid #ccc; }
    .year-content { display: flex; flex-wrap: wrap; padding: 5px; }
    .year-item { width: 50%; display: flex; justify-content: space-between; padding: 4px 8px; font-size: 11px; border-bottom: 1px solid #f9f9f9; }
    .year-total-row { background: #fcfcfc; font-weight: bold; border-top: 2px solid #ddd; padding: 5px 10px; font-size: 12px; display: flex; justify-content: space-between; }
    .analysis-row { display: flex; gap: 20px; margin-top: 25px; align-items: flex-start; }
    .analysis-col { flex: 1; border: 1px solid #eee; border-radius: 8px; padding: 15px; height: 100%; }
    .analysis-title { font-size: 12px; font-weight: bold; color: #324960; margin-bottom: 10px; text-transform: uppercase; border-bottom: 2px solid #324960; padding-bottom: 5px; }
    .top5-table { width: 100%; border-collapse: collapse; font-size: 11px; }
    .top5-table td { padding: 6px 2px; border-bottom: 1px solid #f0f0f0; }
    .dist-bar-container { display: flex; width: 100%; height: 25px; border-radius: 6px; overflow: hidden; background: #f0f0f0; margin-bottom: 15px; }
    .dist-legend { display: flex; flex-wrap: wrap; gap: 10px; font-size: 10px; justify-content: center; }
    .legend-dot { width: 10px; height: 10px; border-radius: 2px; display: inline-block; margin-right: 4px; }
    
    .bagisci-table { width: 100%; border-collapse: collapse; font-size: 7pt; margin-top: 10px; }
    .bagisci-table th, .bagisci-table td { border: 1px solid #ccc; padding: 2px; text-align: center; vertical-align: middle; }
    .bagisci-table thead th { background: #324960 !important; color: #fff !important; font-weight: bold; padding: 4px; }
    .bagisci-table .sub-th { background: #f0f0f0 !important; color: #333 !important; font-weight: normal; font-size: 6pt; }
    .col-name { text-align: left !important; width: 22%; font-weight: 600; white-space: nowrap; overflow: hidden; }
    .col-sep { border-left: 2px solid #999 !important; }
    .bg-daimi { fill: #2d6a4f; background-color: #2d6a4f; } .bg-yeni { fill: #e67e22; background-color: #e67e22; } .bg-pasif { fill: #c0392b; background-color: #c0392b; }
    .legend-box { margin: 10px 0; text-align: center; font-size: 10px; }
    .legend-badge { display: inline-block; width: 12px; height: 12px; line-height: 12px; text-align: center; color:#fff; border-radius:3px; margin-right:3px; font-size:8px;}

    .op-section { page-break-inside: avoid; margin-bottom: 10px; }
    .op-header { background: #324960; color: white; font-size: 11px; font-weight: bold; padding: 4px 8px; border-radius: 4px 4px 0 0; display: flex; justify-content: space-between; }
    .op-list { border: 1px solid #ccc; border-top: none; border-radius: 0 0 4px 4px; font-size: 9px; }
    .op-row { display: flex; border-bottom: 1px solid #eee; padding: 4px 6px; align-items: center; }
    .op-row:last-child { border-bottom: none; }
    .op-row:nth-child(even) { background: #f9f9f9; }
    .check-box { width: 10px; height: 10px; border: 1px solid #999; border-radius: 2px; margin-right: 6px; flex-shrink: 0; }
    .op-name { flex: 1; font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 4px; }
    .op-amount { text-align: right; font-weight: 700; color: #324960; min-width: 45px; font-size: 9px; }
    
    .alert-box { border: 1px solid #e74c3c; background: #fdf0ed; border-radius: 6px; padding: 10px; margin-bottom: 15px; }
    .alert-title { color: #c0392b; font-weight: bold; font-size: 12px; margin-bottom: 5px; display: flex; align-items: center; gap:5px; }
    .alert-desc { font-size: 10px; color: #7f8c8d; margin-bottom: 8px; }
    .grid-3-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: start; }
  </style>
</head>
<body>
  <div id="raporContent">
    <div style="text-align:center; padding:50px;">
      <h3 style="color:#666">Rapor Verisi Y√ºkleniyor...</h3>
      <p style="font-size:12px; color:#999">Bekleyiniz...</p>
    </div>
  </div>

  <script>
    // --- HATA YAKALAMA BLOKLU ANA SCRIPT ---
    try {
        const p = new URLSearchParams(window.location.search);
        const personel = p.get('personel') || 'Personel Adƒ±';
        let data = null;

        // 1. LocalStorage'dan dene
        if (p.get('key')) {
            try {
                const raw = localStorage.getItem(p.get('key'));
                if(raw) {
                    data = JSON.parse(raw);
                    // localStorage.removeItem(p.get('key')); // Test ederken silme
                }
            } catch (e) { console.error("Storage Hatasƒ±:", e); }
        } 
        // 2. URL Parametresinden dene
        else if (p.get('data')) {
            try {
                data = JSON.parse(decodeURIComponent(p.get('data')));
            } catch (e) { console.error("URL Data Hatasƒ±:", e); }
        }

        // HATA KONTROL√ú 1: Veri Yoksa
        if (!data) {
            throw new Error("Rapor verisi (JSON) bulunamadƒ±. L√ºtfen baƒülantƒ±yƒ± kontrol ediniz.");
        }

        // HATA KONTROL√ú 2: Eksik Veri Yapƒ±sƒ±
        if (!data.personel || !data.personel.veriler) {
            throw new Error("Veri yapƒ±sƒ± hatalƒ±: 'personel' veya 'veriler' objesi eksik.");
        }

        // Veri Tamam, Render Et
        render(personel, data);

        // Yazdƒ±rmayƒ± Tetikle
        setTimeout(() => {
             window.print();
        }, 1500);

    } catch (err) {
        // Hata olursa ekrana yazdƒ±r
        document.getElementById('raporContent').innerHTML = `
            <div style="padding:40px; text-align:center; font-family:sans-serif;">
                <h2 style="color:#c0392b">‚ö†Ô∏è Rapor Olu≈üturulamadƒ±</h2>
                <p style="color:#333; margin-top:10px">Sebep: <strong>${err.message}</strong></p>
                <p style="color:#777; font-size:12px; margin-top:20px">Teknik Detay: ${err.stack || err}</p>
            </div>
        `;
    }

    /* --- RENDER FONKSƒ∞YONU --- */
    function render(ad, d) {
      const { personel: pData, bagisciAnaliz: analiz } = d;
      const yillar = [2023, 2024, 2025];
      const analizGuvenli = analiz || {daimi:[],yeni:[],pasif:[]};

      // Hesaplamalar
      const totals = {};
      yillar.forEach(yil => { 
        totals[yil] = ['iftar','sahur','taahhut','teberru'].reduce((s,k)=> 
          s + (pData.veriler[yil]?.[k]||[]).reduce((a,b)=>a+(Number(b.tutar)||0),0), 0
        ); 
      });
      
      const counts = { 
        daimi: (analizGuvenli.daimi || []).length, 
        yeni: (analizGuvenli.yeni || []).length, 
        pasif: (analizGuvenli.pasif || []).length 
      };

      // Top 5 Hesapla
      const allDonors = [];
      ['daimi','yeni','pasif'].forEach(k => (analizGuvenli[k]||[]).forEach(n => { 
         let gt = 0; 
         yillar.forEach(y => ['iftar','sahur','taahhut','teberru'].forEach(t => 
            gt += (pData.veriler[y]?.[t]||[]).filter(x=>x.sahip===n).reduce((a,b)=>a+(Number(b.tutar)||0),0)
         )); 
         if(gt>0) allDonors.push({isim: n, toplam: gt, tur: k}); 
      }));
      const top5 = allDonors.sort((a,b) => b.toplam - a.toplam).slice(0, 5);

      // Kategori Daƒüƒ±lƒ±mƒ±
      let catTotals = { iftar:0, sahur:0, taahhut:0, teberru:0 }; 
      let ggTotal = 0;
      yillar.forEach(y => ['iftar','sahur','taahhut','teberru'].forEach(k => { 
         const v = (pData.veriler[y]?.[k]||[]).reduce((a,b)=>a+(Number(b.tutar)||0),0); 
         catTotals[k]+=v; ggTotal+=v; 
      }));

      // --- HTML B√ñL√úMLERƒ∞ ---

      // 1. Kapak
      const cover = `
        <div class="cover-page">
          <div>
             <div class="cover-personel-name">${ad}</div>
             <div class="kpi-row">${yillar.map(y => `<div class="kpi"><div class="label">${y}</div><div class="value">‚Ç∫${Math.round(totals[y]).toLocaleString('tr-TR')}</div></div>`).join('')}</div>
             <div class="charts-section">
                <div class="chart-box"><span class="chart-title">B√ºy√ºme Trendi</span><div style="height:120px">${createTrendChart(totals)}</div></div>
                <div class="chart-box"><span class="chart-title">Portf√∂y Daƒüƒ±lƒ±mƒ±</span><div style="height:100px">${createDonorBarChart(counts)}</div><div class="portfolio-explanation">Daimi: 3 yƒ±lda da baƒüƒ±≈ü yapanlar | Yeni: Sadece 2025'te baƒüƒ±≈ü yapanlar | Pasif: 2023-2024'te var, 2025'te yok</div></div>
             </div>
          </div>
          <div class="cover-bottom-section">
             <div class="cover-text-container"><div class="cover-main-text">2026 RAMAZAN-I ≈ûERƒ∞F HAZIRLIK RAPORU</div><div class="cover-year-text">Ge√ßmi≈ü d√∂nem performans analizi ve portf√∂y durum raporudur.</div></div>
             <div class="cover-bottom-bar"><img src="../img/logo.png" class="cover-logo-small" onerror="this.style.display='none'"/><div class="cover-bottom-title">KARAAƒûA√á FATƒ∞H</div></div>
          </div>
        </div><div class="page-break"></div>`;

      // 2. √ñzet
      let summary = `<div class="summary-page"><div class="page-title">YIL BAZLI DETAYLAR & ANALƒ∞Z</div>`;
      yillar.forEach(yil => {
         let yTotal = 0;
         summary += `<div class="year-box"><div class="year-header">${yil} YILI D√ñK√úM√ú</div><div class="year-content">`;
         [{k:'iftar',l:'ƒ∞ftar',i:'üåô'},{k:'sahur',l:'Sahur',i:'üåü'},{k:'taahhut',l:'Taahh√ºt',i:'üìã'},{k:'teberru',l:'Teberru',i:'üíù'}].forEach(t => {
            const arr = pData.veriler[yil]?.[t.k] || []; 
            const sum = arr.reduce((a,b)=>a+(Number(b.tutar)||0),0); yTotal += sum;
            if(sum>0||arr.length>0) summary += `<div class="year-item"><span>${t.i} ${t.l} <span style="color:#999">(${arr.length})</span></span><strong>‚Ç∫${Math.round(sum).toLocaleString('tr-TR')}</strong></div>`;
         });
         summary += `</div><div class="year-total-row"><span>TOPLAM</span><span>‚Ç∫${Math.round(yTotal).toLocaleString('tr-TR')}</span></div></div>`;
      });
      summary += `<div class="analysis-row"><div class="analysis-col"><div class="analysis-title">üèÜ En Y√ºksek 5 Baƒüƒ±≈ü√ßƒ±</div><table class="top5-table">${top5.length?top5.map((d,i)=>`<tr><td class="rank-cell">${i+1}.</td><td>${d.isim}</td><td style="text-align:right;font-weight:bold">‚Ç∫${Math.round(d.toplam).toLocaleString('tr-TR')}</td></tr>`).join(''):'<tr><td>Yok</td></tr>'}</table></div><div class="analysis-col"><div class="analysis-title">üìä Gelir Daƒüƒ±lƒ±mƒ±</div><div class="dist-bar-container">${['iftar','sahur','taahhut','teberru'].map(k=>{const p=(ggTotal>0?(catTotals[k]/ggTotal)*100:0); return p>0?`<div style="width:${p}%;background:${k=='iftar'?'#34495e':k=='sahur'?'#e67e22':k=='taahhut'?'#27ae60':'#c0392b'};height:100%"></div>`:''}).join('')}</div><div class="dist-legend"><span style="color:#34495e">‚ñ† ƒ∞ftar</span> <span style="color:#e67e22">‚ñ† Sahur</span> <span style="color:#27ae60">‚ñ† Taahh√ºt</span> <span style="color:#c0392b">‚ñ† Teberru</span></div></div></div></div><div class="page-break"></div>`;

      // 3. Tablo
      const flatList = []; ['daimi','yeni','pasif'].forEach(k => (analizGuvenli[k]||[]).forEach(n => flatList.push({isim:n, tur:k})));
      flatList.sort((a,b) => ({daimi:1,yeni:2,pasif:3}[a.tur] - {daimi:1,yeni:2,pasif:3}[b.tur]) || a.isim.localeCompare(b.isim,'tr-TR'));
      let table = `<div class="summary-page"><div class="page-title">DETAYLI BAƒûI≈û√áI Lƒ∞STESƒ∞</div><div class="legend-box"><span class="legend-badge bg-daimi">D</span> Daimi <span class="legend-badge bg-yeni">Y</span> Yeni <span class="legend-badge bg-pasif">P</span> Pasif</div><table class="bagisci-table"><thead><tr><th style="text-align:left">BAƒûI≈û√áI</th>${yillar.map(y=>`<th colspan="4" class="col-sep">${y}</th>`).join('')}</tr><tr><th></th>${yillar.map(y=>`<th class="sub-th col-sep">ƒ∞ft</th><th class="sub-th">Sah</th><th class="sub-th">Tah</th><th class="sub-th">Teb</th>`).join('')}</tr></thead><tbody>${flatList.map(b=>`<tr><td class="col-name"><span class="legend-badge bg-${b.tur}">${b.tur[0].toUpperCase()}</span> ${b.isim}</td>${yillar.map(y=>['iftar','sahur','taahhut','teberru'].map((t,i)=>`<td class="${i==0?'col-sep':''}">${(pData.veriler[y]?.[t]||[]).filter(x=>x.sahip===b.isim).reduce((s,v)=>s+(Number(v.tutar)||0),0)>0?'‚Ç∫'+Math.round((pData.veriler[y]?.[t]||[]).filter(x=>x.sahip===b.isim).reduce((s,v)=>s+(Number(v.tutar)||0),0)).toLocaleString('tr-TR'):''}</td>`).join('')).join('')}</tr>`).join('')}</tbody></table></div><div class="page-break"></div>`;

      // 4. Op Listeleri
      let opPage = `<div class="summary-page">
         <div class="page-title">2026 OPERASYONEL √áALI≈ûMA Lƒ∞STELERƒ∞</div>
         ${createLostDonorsList(pData)}
         <div class="grid-3-col">
            ${createOpList('üåô 2025 ƒ∞FTAR', pData.veriler[2025]?.iftar || [])}
            ${createOpList('üåü 2025 SAHUR', pData.veriler[2025]?.sahur || [])}
            ${createOpList('üìã 2025 TAAHH√úT', pData.veriler[2025]?.taahhut || [])}
         </div>
      </div>`;

      document.getElementById('raporContent').innerHTML = cover + summary + table + opPage;
    }

    /* --- YARDIMCI FONKSƒ∞YONLAR --- */
    function createTrendChart(totals) {
      const values = [totals[2023], totals[2024], totals[2025]];
      const maxVal = Math.max(...values) || 1;
      const w=580, h=120, scaleY=v=>h-20-((v/(maxVal*1.15))*(h-40));
      const p1={x:80,y:scaleY(values[0]),v:values[0],yr:2023}, p2={x:290,y:scaleY(values[1]),v:values[1],yr:2024}, p3={x:500,y:scaleY(values[2]),v:values[2],yr:2025};
      const linePath=`M ${p1.x} ${p1.y} L ${p2.x} ${p2.y} L ${p3.x} ${p3.y}`, areaPath=`${linePath} L ${p3.x} ${h} L ${p1.x} ${h} Z`;
      
      // B√ºy√ºme y√ºzdeleri hesapla
      const getGrowth = (v1, v2) => {
        if(v1 === 0) return v2 > 0 ? "+100%" : "0%";
        const p = ((v2 - v1) / v1) * 100;
        return (p > 0 ? "+" : "") + Math.round(p) + "%";
      };
      const g1 = getGrowth(values[0], values[1]); const c1 = g1.includes('-') ? 'negative' : '';
      const g2 = getGrowth(values[1], values[2]); const c2 = g2.includes('-') ? 'negative' : '';
      
      return `<svg viewBox="0 0 ${w} ${h}"><defs><linearGradient id="gradientFill" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#324960"/><stop offset="100%" stop-color="#fff" stop-opacity="0"/></linearGradient></defs><path d="${areaPath}" class="chart-area"/><path d="${linePath}" class="chart-line"/>${[p1,p2,p3].map(p=>`<line x1="${p.x}" y1="${p.y}" x2="${p.x}" y2="${h-15}" stroke="#eee" stroke-dasharray="3"/><circle cx="${p.x}" cy="${p.y}" r="4" class="chart-point"/><text x="${p.x}" y="${h}" style="font-size:10px;fill:#666;text-anchor:middle">${p.yr}</text><text x="${p.x}" y="${p.y-10}" style="font-size:11px;font-weight:bold;fill:#324960;text-anchor:middle">‚Ç∫${Math.round(p.v).toLocaleString('tr-TR')}</text>`).join('')}<rect x="${(p1.x+p2.x)/2-20}" y="${(p1.y+p2.y)/2-25}" width="40" height="18" class="growth-bg ${c1}" rx="3"/><text x="${(p1.x+p2.x)/2}" y="${(p1.y+p2.y)/2-12}" class="growth-badge" text-anchor="middle">${g1}</text><rect x="${(p2.x+p3.x)/2-20}" y="${(p2.y+p3.y)/2-25}" width="40" height="18" class="growth-bg ${c2}" rx="3"/><text x="${(p2.x+p3.x)/2}" y="${(p2.y+p3.y)/2-12}" class="growth-badge" text-anchor="middle">${g2}</text></svg>`;
    }
    function createDonorBarChart(c) {
      const t=c.daimi+c.yeni+c.pasif||1, w=580, rh=25, g=12, h=(rh*3)+(g*2);
      const draw=(y,l,v,cl)=>`<text x="0" y="${y+16}" class="bar-text">${l}</text><rect x="80" y="${y}" width="450" height="${rh}" class="bar-bg"/><rect x="80" y="${y}" width="${Math.max((v/t)*450,4)}" height="${rh}" class="bar-fill ${cl}"/><text x="570" y="${y+17}" class="bar-count">${v} Ki≈üi</text><text x="85" y="${y+17}" style="font-size:9px;fill:#fff;font-weight:bold;opacity:${(v/t)*450>20?1:0}">${Math.round((v/t)*100)}%</text>`;
      return `<svg viewBox="0 0 ${w} ${h}">${draw(0,"DAƒ∞Mƒ∞",c.daimi,"bg-daimi")}${draw(rh+g,"YENƒ∞",c.yeni,"bg-yeni")}${draw((rh+g)*2,"PASƒ∞F",c.pasif,"bg-pasif")}</svg>`;
    }
    function createOpList(t,v) {
      if(!v||v.length===0) return `<div class="op-section"><div class="op-header"><span>${t}</span><span>0</span></div><div class="op-list" style="padding:10px;text-align:center;color:#999">Yok</div></div>`;
      const rows = v.sort((a,b)=>(Number(b.tutar)||0)-(Number(a.tutar)||0)).map(x=>`<div class="op-row"><div class="check-box"></div><div class="op-name" title="${x.sahip}">${x.sahip}</div><div class="op-amount">‚Ç∫${Math.round(Number(x.tutar)||0).toLocaleString('tr-TR')}</div></div>`).join('');
      return `<div class="op-section"><div class="op-header"><span>${t}</span><span>${v.length}</span></div><div class="op-list">${rows}</div></div>`;
    }
    function createLostDonorsList(p) {
       const old=new Set(), curr=new Set();
       [2023,2024].forEach(y=>['iftar','sahur','taahhut','teberru'].forEach(k=>(p.veriler[y]?.[k]||[]).forEach(v=>old.add(v.sahip))));
       ['iftar','sahur','taahhut','teberru'].forEach(k=>(p.veriler[2025]?.[k]||[]).forEach(v=>curr.add(v.sahip)));
       const lost=[...old].filter(d=>!curr.has(d)).sort();
       return lost.length?`<div class="alert-box"><div class="alert-title">‚ö†Ô∏è GERƒ∞ KAZANIM (KAYIP BAƒûI≈û√áILAR)</div><div class="alert-desc">2023-24'te var, 2025'te yok:</div><div style="font-size:11px;font-weight:600">${lost.map(x=>`<span style="display:inline-block;margin-right:10px;background:white;padding:2px 6px;border:1px solid #fadbd8;margin-bottom:4px;border-radius:4px">‚¨ú ${x}</span>`).join('')}</div></div>`:'';
    }
  </script>
</body>
</html>
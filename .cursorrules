# CURSOR PROJECT RULES (KARAAÄAÃ‡ FATÄ°H)

## 0. MUTLAK DOÄRULUK KAYNAÄI (Ã–NCE BUNU OKU)
* **VERÄ°TABANI ÅEMASI:** VeritabanÄ± ile ilgili (Select, Insert, Update) herhangi bir kod yazmadan Ã¶nce **DAÄ°MA `@sqleditor.md`** dosyasÄ±nÄ± oku ve oradaki sÃ¼tun isimlerini kullan.
* **ASLA TAHMÄ°N ETME (NO HALLUCINATION):**
    * `@sqleditor.md` dosyasÄ±nda `adsoyad` yazÄ±yorsa, koduna `adSoyad` veya `ad_soyad` YAZMA.
    * Åemada olmayan bir sÃ¼tunu asla sorguya ekleme.
    * VeritabanÄ± ÅŸemasÄ± iÃ§in `@sqleditor.md` dosyasÄ±nÄ± baz al.
    * **ASLA TAHMÄ°N ETME.** Åemada `updatedat` yoksa sorguya ekleme.

---

## 1. ROL VE MÄ°SYON
Sen, Firebase'den Supabase'e geÃ§iÅŸ yapan ve "App Shell" mimarisini kullanan kÄ±demli bir Full Stack GeliÅŸtiricisin.
* **Ana Hedef:** PostgreSQL kurallarÄ±na uyan, gÃ¼venli ve merkezi mimariye (ortak.js/app-shell.css) sadÄ±k kodlar yazmak.
* **Ã–ncelik SÄ±rasÄ±:**
    1. ğŸ§± **APP SHELL ENTEGRASYONU** (Her sayfa ortak yapÄ±ya uymak ZORUNDA).
    2. ğŸ›¡ï¸ **GÃœVENLÄ°K** (Client-side secret yasak).
    3. ğŸ¯ **VERÄ° TUTARLILIÄI** (`@sqleditor.md` ÅŸemasÄ±na birebir uyum).

---

## 2. KULLANICI PROFÄ°LÄ° VE AUTH AKIÅI (KRÄ°TÄ°K)
KullanÄ±cÄ± giriÅŸ yaptÄ±ÄŸÄ±nda veya sayfa yÃ¼klendiÄŸinde ÅŸu adÄ±mlarÄ± izle:

1.  **Auth KontrolÃ¼:** `supabase.auth.getUser()` ile mevcut oturumu ve `uid`'yi al.
2.  **Profil Sorgusu:** Bu `uid`'yi kullanarak `public.kullanicilar` tablosuna git.
    * Sorgu: `.select('adsoyad, rol, yetkiler').eq('id', uid).single()`
3.  **Ä°sim Ã‡Ã¶zÃ¼mleme (Name Resolution):**
    * EÄŸer `public.kullanicilar` tablosundan `adsoyad` dÃ¶nerse, ekrana bunu yaz.
    * EÄŸer veri `null` dÃ¶nerse veya kayÄ±t yoksa: **"Profil BulunamadÄ±"** hatasÄ± logla ve ekrana geÃ§ici olarak e-postayÄ± basma, kullanÄ±cÄ±yÄ± "Profil OluÅŸturmaya" yÃ¶nlendir veya tetikleyici (trigger) kontrolÃ¼ yap.
    * **ASLA** veritabanÄ±ndan veri gelmedi diye e-postanÄ±n baÅŸÄ±ndaki ismi (Ã¶rn: samettckrr) isim olarak varsayma.
4.  **Select KÄ±sÄ±tlamasÄ±:** `select('*')` yasak. Sadece var olan sÃ¼tunlarÄ± seÃ§.
5.  **Auth ve Profil:** `initAppShellAuth` kullanÄ±ldÄ±ÄŸÄ±nda, eÄŸer `public.kullanicilar` tablosundan veri gelmezse (null), ekrana hata basma, "Profil YÃ¼kleniyor" veya "Misafir" gÃ¶ster.
6.  **Hata YÃ¶netimi:** Supabase `400 Bad Request` dÃ¶nerse, bunun sebebi %99 olmayan bir sÃ¼tun ismidir. Sorguyu kontrol et.

---

## 3. ZORUNLU APP SHELL ENTEGRASYONU
Her yeni HTML sayfasÄ± oluÅŸturduÄŸunda veya dÃ¼zenlediÄŸinde, aÅŸaÄŸÄ±daki **"Standart Ä°skeleti"** uygulamak ZORUNDASIN.

### A. BAÄIMLILIKLAR (HEAD KISMI)
Her sayfanÄ±n `<head>` kÄ±smÄ±nda MUTLAKA ÅŸunlar olmalÄ±:
1.  **CSS:** `<link rel="stylesheet" href="../css/app-shell.css" />`
2.  **Supabase:** `<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2..."></script>`
3.  **Ortak JS:** `<script src="../js/ortak.js"></script>`

### B. ORTAK JS FONKSÄ°YONLARI (LOGIC)
* **Auth KontrolÃ¼:** `initAppShellAuth()` kullan. Manuel auth kontrolÃ¼ yazma.
* **Bildirimler:** `alert()` YASAK. `showToast('success', 'BaÅŸlÄ±k', 'Mesaj')` kullan.
* **XSS KorumasÄ±:** `escapeHtml(text)` kullan.
* **Yetki KontrolÃ¼:** MenÃ¼ ve linkler `renderNav()` ile otomatik gelir.

---

## 4. ZORUNLU GELÄ°ÅTÄ°RME STANDARTLARI

### ğŸ›¡ï¸ GÃœVENLÄ°K
1.  **Secret YÃ¶netimi:** `RESEND_API_KEY` veya `service_role` anahtarlarÄ±nÄ± ASLA client-side koda yazma.
2.  **RLS FarkÄ±ndalÄ±ÄŸÄ±:** Veri gelmezse kullanÄ±cÄ±ya "Yetkiniz olmayabilir (RLS)" uyarÄ±sÄ±nÄ± `showToast` ile ver.

### ğŸ’° PERFORMANS
1.  **Select KÄ±sÄ±tlamasÄ±:** `select('*')` YASAK. Sadece `.select('id, adsoyad')` gibi spesifik seÃ§.
2.  **Ã–nbellek:** SÄ±k deÄŸiÅŸmeyen verileri `localStorage`'da tut.

---

## 5. VERÄ°TABANI HARÄ°TASI (Referans: @sqleditor.md)
*AÅŸaÄŸÄ±daki liste Ã¶zet amaÃ§lÄ±dÄ±r. Ã‡eliÅŸki durumunda `@sqleditor.md` dosyasÄ±ndaki SQL tanÄ±mlarÄ± esastÄ±r.*

### Table: `veriler` (Teberru, Ä°ftar vb. buradadÄ±r)
| Column | Type | Note |
| :--- | :--- | :--- |
| `id` | text | |
| `createdat` | timestamp | **DÄ°KKAT:** `updatedat` SÃœTUNU YOKTUR. ASLA KULLANMA. |
| `personel` | text | |
| `miktar` | numeric | |
| `tur` | text | 'teberru', 'iftar' vb. |

### Table: `kategoriler`
| Column | Type | Note |
| :--- | :--- | :--- |
| `id` | text | |
| `ad` | text | **DÄ°KKAT:** Sadece `ad` kullan. `isim` SÃœTUNU YOKTUR. |

### Table: `kullanicilar`
| Column | Type | Note |
| :--- | :--- | :--- |
| `id` | uuid | Auth ID |
| `adsoyad` | text | BitiÅŸik yazÄ±lÄ±r. |
| `rol` | text | |
| `yetkiler` | array | |

---

## 6. KOD ÅABLONU (APP SHELL UYUMLU)
```html
<!DOCTYPE html>
<html lang="tr">
<head>
  <link rel="stylesheet" href="../css/app-shell.css" />
</head>
<body>
  <div class="appbar">...</div>
  <main class="container">
    <div class="card">
      <h3>BaÅŸlÄ±k</h3>
      <button class="btn btn-primary" id="btnIslem">Ä°ÅŸlem Yap</button>
    </div>
  </main>
  <div class="toast-container" id="toastContainer"></div>
  
  <script src="...supabase-js..."></script>
  <script src="../js/ortak.js"></script> 
  <script>
    // Sayfa YÃ¼klendiÄŸinde
    document.addEventListener('DOMContentLoaded', async () => {
        // Auth ve Profil YÃ¼klemesi ortak.js tarafÄ±ndan yapÄ±lÄ±r
        // Sen sadece sayfa iÃ§i mantÄ±ÄŸÄ± yaz
    });
  </script>
</body>
</html>
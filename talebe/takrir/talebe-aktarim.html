<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talebe Aktarƒ±m</title>
    <link rel="stylesheet" href="../../css/app-shell.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #3ecf8e;
            padding-bottom: 8px;
        }
        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #f9f9f9;
            margin: 16px 0;
            transition: all 0.3s;
        }
        .file-upload-area.dragover {
            border-color: #3ecf8e;
            background: #f0fdf4;
        }
        .file-input-wrapper {
            margin: 16px 0;
        }
        .file-input-wrapper input[type="file"] {
            display: none;
        }
        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: #3ecf8e;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        .file-label:hover {
            background: #34b379;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .file-item.success {
            background: #d1fae5;
            color: #065f46;
        }
        .file-item.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .file-item .file-info {
            flex: 1;
        }
        .file-item .file-name {
            font-weight: 500;
        }
        .file-item .file-stats {
            font-size: 0.9em;
            color: #666;
            margin-top: 4px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #3ecf8e;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background: #34b379;
        }
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background: #4b5563;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.9em;
        }
        .preview-table th,
        .preview-table td {
            padding: 8px;
            text-align: left;
            border: 1px solid #ddd;
        }
        .preview-table th {
            background: #f3f4f6;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        .preview-table tr.error-row {
            background: #fee2e2;
        }
        .preview-table tr.success-row {
            background: #d1fae5;
        }
        .preview-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        .summary-item {
            padding: 16px;
            background: #f9fafb;
            border-radius: 6px;
            border-left: 4px solid #3ecf8e;
        }
        .summary-item.error {
            border-left-color: #ef4444;
        }
        .summary-item .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 4px;
        }
        .summary-item .value {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }
        .progress-bar {
            width: 100%;
            height: 24px;
            background: #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin: 16px 0;
        }
        .progress-fill {
            height: 100%;
            background: #3ecf8e;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85em;
            font-weight: 500;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .status-badge.success {
            background: #d1fae5;
            color: #065f46;
        }
        .status-badge.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        
        /* Toast Container */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            min-width: 300px;
            max-width: 500px;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            font-size: 14px;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .toast.success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }
        .toast.error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }
        .toast.warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        .toast.info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        .toast-icon {
            font-size: 20px;
        }
        .toast-content {
            flex: 1;
        }
        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .toast-message {
            font-size: 13px;
            opacity: 0.9;
        }
        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.6;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toast-close:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <section class="card header-card">
            <div class="header-left">
                <h2>üì• Talebe Aktarƒ±m</h2>
                <div class="muted">CSV dosyasƒ± ile talebe bilgilerini Supabase'e aktar</div>
            </div>
            <div class="header-right">
                <button class="btn btn-secondary" onclick="downloadTemplate()">üìã ≈ûablon ƒ∞ndir</button>
                <a href="ders-takip.html" class="btn btn-secondary">‚Üê Geri</a>
            </div>
        </section>

        <!-- Dosya Y√ºkleme -->
        <section class="card">
            <h3>1. CSV Dosyasƒ±nƒ± Y√ºkle</h3>
            <div class="file-upload-area" id="uploadArea">
                <p>üìÅ Dosyayƒ± buraya s√ºr√ºkle veya se√ß</p>
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept=".csv">
                    <label for="fileInput" class="file-label">Dosya Se√ß</label>
                </div>
                <p class="muted" style="margin-top: 12px; font-size: 0.9em;">
                    CSV formatƒ±: id, devre, talebe_adi
                </p>
            </div>
            <div class="file-list" id="fileList"></div>
        </section>

        <!-- Doƒürulama ve √ñnizleme -->
        <section class="card" id="previewSection" style="display: none;">
            <h3>2. Veri Doƒürulama ve √ñnizleme</h3>
            <div class="summary" id="summary"></div>
            <div class="preview-container" id="previewContainer"></div>
            <div class="actions">
                <button class="btn btn-primary" id="importBtn" onclick="importToSupabase()" disabled>
                    ‚úÖ Supabase'e Aktar
                </button>
                <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Temizle</button>
            </div>
        </section>

        <!-- Aktarƒ±m ƒ∞lerlemesi -->
        <section class="card" id="progressSection" style="display: none;">
            <h3>3. Aktarƒ±m ƒ∞lerlemesi</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
            </div>
            <div id="progressStatus"></div>
        </section>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        // Supabase client initialization
        const SUPABASE_URL = 'https://lmwfibippjvqctccxiwb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxtd2ZpYmlwcGp2cWN0Y2N4aXdiIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjE2NzA1NCwiZXhwIjoyMDgxNzQzMDU0fQ.lzoudrJx_V4RdCCxPRfgLA1riWNKZ3HyFzeqRynYHeQ';
        
        if (typeof supabase !== 'undefined' && typeof supabase.createClient === 'function') {
            window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        }

        // Toast fonksiyonu
        function showToast(type, title, message) {
            const container = document.getElementById('toastContainer');
            if (!container) return;

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
                <div class="toast-content">
                    <div class="toast-title">${escapeHtml(title)}</div>
                    <div class="toast-message">${escapeHtml(message)}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            container.appendChild(toast);

            // 5 saniye sonra otomatik kaldƒ±r
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 5000);
        }

        // HTML escape
        function escapeHtml(text) {
            if (text == null) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        let uploadedFile = null;
        let validatedData = [];
        let currentUser = null;

        // Sayfa y√ºklendiƒüinde
        document.addEventListener('DOMContentLoaded', async () => {
            await initAuth();
            setupFileUpload();
        });

        // Auth kontrol√º
        async function initAuth() {
            if (!window.supabase) {
                showToast('error', 'Hata', 'Supabase baƒülantƒ±sƒ± kurulamadƒ±');
                return;
            }
            const { data: { session } } = await window.supabase.auth.getSession();
            if (!session) {
                showToast('error', 'Hata', 'L√ºtfen giri≈ü yapƒ±n');
                setTimeout(() => location.href = '../../index.html', 2000);
                return;
            }
            currentUser = session.user;
        }

        // Dosya y√ºkleme ayarlarƒ±
        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');

            // Dosya se√ßildiƒüinde
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });

            // Drag & Drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files).filter(f => f.name.endsWith('.csv'));
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        // Dosyayƒ± i≈üle
        async function handleFile(file) {
            uploadedFile = {
                file: file,
                name: file.name,
                size: file.size,
                status: 'processing',
                data: null,
                errors: [],
                validRows: [],
                invalidRows: []
            };

            await processFile(uploadedFile);
            renderFileList();
            validateAllData();
        }

        // Dosyayƒ± i≈üle ve doƒürula
        async function processFile(fileData) {
            return new Promise((resolve) => {
                Papa.parse(fileData.file, {
                    header: true,
                    skipEmptyLines: true,
                    encoding: 'UTF-8',
                    complete: (results) => {
                        fileData.data = results.data;
                        fileData.errors = results.errors;
                        validateFileData(fileData);
                        fileData.status = fileData.invalidRows.length === 0 && fileData.validRows.length > 0 ? 'success' : 'error';
                        resolve();
                    },
                    error: (error) => {
                        fileData.errors.push({ message: `CSV okuma hatasƒ±: ${error.message}` });
                        fileData.status = 'error';
                        resolve();
                    }
                });
            });
        }

        // Dosya verilerini doƒürula
        function validateFileData(fileData) {
            const requiredFields = ['id', 'devre', 'talebe_adi'];
            
            fileData.validRows = [];
            fileData.invalidRows = [];

            fileData.data.forEach((row, index) => {
                const rowErrors = [];
                const rowNum = index + 2; // +2 √ß√ºnk√º header var ve index 0'dan ba≈ülƒ±yor

                // Zorunlu alanlarƒ± kontrol et
                for (const field of requiredFields) {
                    if (!row[field] || String(row[field]).trim() === '') {
                        rowErrors.push(`${field} alanƒ± bo≈ü olamaz`);
                    }
                }

                if (rowErrors.length > 0) {
                    fileData.invalidRows.push({
                        row: rowNum,
                        data: row,
                        errors: rowErrors
                    });
                } else {
                    fileData.validRows.push(row);
                }
            });
        }

        // T√ºm verileri doƒürula ve √∂nizleme g√∂ster
        function validateAllData() {
            validatedData = [];
            const allErrors = [];

            if (uploadedFile && uploadedFile.validRows) {
                validatedData.push(...uploadedFile.validRows);
            }
            if (uploadedFile && uploadedFile.invalidRows) {
                allErrors.push(...uploadedFile.invalidRows.map(r => ({
                    file: uploadedFile.name,
                    ...r
                })));
            }

            // √ñzet istatistikler
            const totalRows = validatedData.length + allErrors.length;
            const validRows = validatedData.length;
            const invalidRows = allErrors.length;

            // √ñzet g√∂ster
            renderSummary(totalRows, validRows, invalidRows);
            
            // √ñnizleme g√∂ster
            renderPreview(validatedData.slice(0, 100), allErrors.slice(0, 50));

            // Aktarƒ±m butonunu aktif/pasif yap
            const importBtn = document.getElementById('importBtn');
            importBtn.disabled = validRows === 0 || invalidRows > 0;

            // Preview section'ƒ± g√∂ster
            document.getElementById('previewSection').style.display = 'block';
        }

        // √ñzet g√∂ster
        function renderSummary(total, valid, invalid) {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.innerHTML = `
                <div class="summary-item">
                    <div class="label">Toplam Satƒ±r</div>
                    <div class="value">${total}</div>
                </div>
                <div class="summary-item success">
                    <div class="label">Ge√ßerli Satƒ±r</div>
                    <div class="value">${valid}</div>
                </div>
                <div class="summary-item ${invalid > 0 ? 'error' : ''}">
                    <div class="label">Hatalƒ± Satƒ±r</div>
                    <div class="value">${invalid}</div>
                </div>
            `;
        }

        // √ñnizleme g√∂ster
        function renderPreview(validData, errors) {
            const container = document.getElementById('previewContainer');
            let html = '';

            // Ge√ßerli veriler
            if (validData.length > 0) {
                html += '<h4 style="margin-top: 0;">‚úÖ Ge√ßerli Veriler (ƒ∞lk 100 satƒ±r)</h4>';
                html += '<table class="preview-table">';
                html += '<thead><tr><th>ID</th><th>Devre</th><th>Talebe Adƒ±</th></tr></thead>';
                html += '<tbody>';
                validData.forEach(row => {
                    html += '<tr class="success-row">';
                    html += `<td>${escapeHtml(row.id || '')}</td>`;
                    html += `<td>${escapeHtml(row.devre || '')}</td>`;
                    html += `<td>${escapeHtml(row.talebe_adi || '')}</td>`;
                    html += '</tr>';
                });
                html += '</tbody></table>';
            }

            // Hatalƒ± veriler
            if (errors.length > 0) {
                html += '<h4 style="margin-top: 24px;">‚ùå Hatalƒ± Veriler (ƒ∞lk 50 satƒ±r)</h4>';
                html += '<table class="preview-table">';
                html += '<thead><tr><th>Satƒ±r</th><th>Hata</th><th>Veri</th></tr></thead>';
                html += '<tbody>';
                errors.forEach(err => {
                    html += '<tr class="error-row">';
                    html += `<td>${err.row}</td>`;
                    html += `<td>${escapeHtml(err.errors.join(', '))}</td>`;
                    html += `<td><small>${escapeHtml(JSON.stringify(err.data).substring(0, 100))}...</small></td>`;
                    html += '</tr>';
                });
                html += '</tbody></table>';
            }

            container.innerHTML = html;
        }

        // Dosya listesini g√∂ster
        function renderFileList() {
            const fileListDiv = document.getElementById('fileList');
            if (!uploadedFile) {
                fileListDiv.innerHTML = '';
                return;
            }

            const statusBadge = uploadedFile.status === 'success' 
                ? '<span class="status-badge success">‚úÖ Ge√ßerli</span>'
                : uploadedFile.status === 'error'
                ? '<span class="status-badge error">‚ùå Hata</span>'
                : '<span class="status-badge">‚è≥ ƒ∞≈üleniyor...</span>';

            const validCount = uploadedFile.validRows ? uploadedFile.validRows.length : 0;
            const invalidCount = uploadedFile.invalidRows ? uploadedFile.invalidRows.length : 0;
            const totalCount = validCount + invalidCount;

            fileListDiv.innerHTML = `
                <div class="file-item ${uploadedFile.status}">
                    <div class="file-info">
                        <div class="file-name">${escapeHtml(uploadedFile.name)}</div>
                        <div class="file-stats">
                            ${statusBadge} | 
                            Toplam: ${totalCount} | 
                            Ge√ßerli: ${validCount} | 
                            Hatalƒ±: ${invalidCount}
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="removeFile()" style="padding: 6px 12px; font-size: 0.9em;">Kaldƒ±r</button>
                </div>
            `;
        }

        // Dosyayƒ± kaldƒ±r
        function removeFile() {
            uploadedFile = null;
            validatedData = [];
            document.getElementById('fileInput').value = '';
            renderFileList();
            document.getElementById('previewSection').style.display = 'none';
        }

        // Supabase'e aktar
        async function importToSupabase() {
            if (!window.supabase || !currentUser) {
                showToast('error', 'Hata', 'Supabase baƒülantƒ±sƒ± veya oturum bulunamadƒ±');
                return;
            }

            if (validatedData.length === 0) {
                showToast('warning', 'Uyarƒ±', 'Aktarƒ±lacak ge√ßerli veri yok');
                return;
            }

            const importBtn = document.getElementById('importBtn');
            importBtn.disabled = true;
            importBtn.textContent = '‚è≥ Aktarƒ±lƒ±yor...';

            const progressSection = document.getElementById('progressSection');
            const progressFill = document.getElementById('progressFill');
            const progressStatus = document.getElementById('progressStatus');
            progressSection.style.display = 'block';

            try {
                // Verileri hazƒ±rla
                const records = validatedData.map(row => ({
                    id: String(row.id).trim(),
                    devre: String(row.devre).trim(),
                    talebe_adi: String(row.talebe_adi).trim()
                }));

                // Batch insert (Supabase 1000 satƒ±r limiti var, chunk'lara b√∂l)
                const chunkSize = 500;
                let totalInserted = 0;
                let totalSkipped = 0;
                let totalErrors = 0;

                for (let i = 0; i < records.length; i += chunkSize) {
                    const chunk = records.slice(i, i + chunkSize);
                    const progress = Math.round(((i + chunk.length) / records.length) * 100);

                    progressFill.style.width = `${progress}%`;
                    progressFill.textContent = `${progress}%`;
                    progressStatus.innerHTML = `
                        <p>ƒ∞≈üleniyor: ${i + 1} - ${Math.min(i + chunkSize, records.length)} / ${records.length}</p>
                        <p>‚úÖ Aktarƒ±lan: ${totalInserted} | ‚è≠Ô∏è Atlanan: ${totalSkipped} | ‚ùå Hata: ${totalErrors}</p>
                    `;

                    try {
                        const { data, error } = await window.supabase
                            .from('talebeler')
                            .insert(chunk)
                            .select();

                        if (error) {
                            // UNIQUE constraint hatasƒ± varsa, tek tek dene
                            if (error.code === '23505') {
                                // Her kaydƒ± tek tek kontrol et
                                for (const record of chunk) {
                                    try {
                                        // √ñnce var mƒ± kontrol et
                                        const { data: existing } = await window.supabase
                                            .from('talebeler')
                                            .select('id')
                                            .eq('id', record.id)
                                            .single();

                                        if (existing) {
                                            // Varsa g√ºncelle
                                            const { error: updateError } = await window.supabase
                                                .from('talebeler')
                                                .update({ devre: record.devre, talebe_adi: record.talebe_adi })
                                                .eq('id', record.id);
                                            
                                            if (updateError) {
                                                totalErrors++;
                                            } else {
                                                totalInserted++;
                                            }
                                        } else {
                                            // Yoksa ekle
                                            const { error: insertError } = await window.supabase
                                                .from('talebeler')
                                                .insert(record)
                                                .select();
                                            
                                            if (insertError) {
                                                totalErrors++;
                                            } else {
                                                totalInserted++;
                                            }
                                        }
                                    } catch (e) {
                                        totalErrors++;
                                        console.error('Record insert/update error:', e);
                                    }
                                }
                            } else {
                                totalErrors += chunk.length;
                                console.error('Batch insert error:', error);
                            }
                        } else {
                            totalInserted += data.length;
                        }
                    } catch (e) {
                        totalErrors += chunk.length;
                        console.error('Chunk insert exception:', e);
                    }
                }

                progressFill.style.width = '100%';
                progressFill.textContent = '100%';
                progressStatus.innerHTML = `
                    <p style="color: green; font-weight: 600;">‚úÖ Aktarƒ±m Tamamlandƒ±!</p>
                    <p>‚úÖ Aktarƒ±lan: ${totalInserted} | ‚è≠Ô∏è Atlanan (zaten var): ${totalSkipped} | ‚ùå Hata: ${totalErrors}</p>
                `;

                showToast('success', 'Ba≈üarƒ±lƒ±', `${totalInserted} kayƒ±t ba≈üarƒ±yla aktarƒ±ldƒ±`);

                // 3 saniye sonra sayfayƒ± yenile
                setTimeout(() => {
                    location.reload();
                }, 3000);

            } catch (error) {
                console.error('Import error:', error);
                showToast('error', 'Hata', `Aktarƒ±m sƒ±rasƒ±nda hata olu≈ütu: ${error.message}`);
                progressStatus.innerHTML = `<p style="color: red;">‚ùå Hata: ${error.message}</p>`;
            } finally {
                importBtn.disabled = false;
                importBtn.textContent = '‚úÖ Supabase\'e Aktar';
            }
        }

        // ≈ûablon indir
        function downloadTemplate() {
            const headers = ['id', 'devre', 'talebe_adi'];
            const sample = [
                ['talebe-001', '6.Devre', 'Ahmet Yƒ±lmaz'],
                ['talebe-002', '6.Devre', 'Mehmet Demir'],
                ['talebe-003', '7.Devre', 'Ali Veli']
            ];

            const csv = [headers, ...sample].map(row => 
                row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'talebeler-sablon.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // T√ºm√ºn√º temizle
        function clearAll() {
            if (confirm('T√ºm y√ºklenen dosyalarƒ± ve verileri temizlemek istediƒüinize emin misiniz?')) {
                uploadedFile = null;
                validatedData = [];
                document.getElementById('fileInput').value = '';
                document.getElementById('fileList').innerHTML = '';
                document.getElementById('previewSection').style.display = 'none';
                document.getElementById('progressSection').style.display = 'none';
            }
        }

    </script>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Talebe Paneli</title>
  <link rel="icon" type="image/png" href="img/logo.png">
  <link rel="stylesheet" href="css/stiller.css" />

<!-- Firebase core kütüphaneleri (compat sürüm) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<!-- Ortak Firebase config ve servis dosyası -->
<script src="js/firebase/firebase-init.js"></script>

  <!-- Ortak JS -->
  <script defer src="js/ortak.js"></script>
  <script defer src="js/icerikyukle.js"></script>

  <style>
    html.gizli {
      visibility: hidden;
    }
  </style>

<script>
  document.documentElement.classList.add('gizli');

  const GEREKEN_YETKI = "Talebe"; // ← bu kısmı her sayfa için değiştir

  firebase.auth().onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "../index.html";
      return;
    }

    try {
      const doc = await firebase.firestore().collection("kullanicilar").doc(user.uid).get();
      const veri = doc.data();
      const yetkiler = veri?.yetkiler || [];

      if (!yetkiler.includes(GEREKEN_YETKI)) {
        window.location.href = "../yetki-yok.html";
      } else {
        document.documentElement.classList.remove('gizli');
      }

    } catch (err) {
      console.error("Yetki kontrol hatası:", err.message);
      window.location.href = "../yetki-yok.html";
    }
  });
</script>
</head>

<body class="gizli">

  <!-- ÜST PANEL -->
  <header class="ust-panel">
    <div class="ust-sol">
      <div class="menu-icon" onclick="menuToggle(event)">☰</div>
      <span class="logo-yazi" onclick="sayfayiYenile()">📘 Karaağaç Fatih | Talebe Paneli</span>
    </div>
    <div class="ust-sag masaustu">
      <button class="cikis-buton" onclick="cikisYap()">Çıkış Yap</button>
    </div>
  </header>

  <!-- ANA PANEL -->
  <div class="ana-panel">
    <!-- YAN PANEL -->
    <nav class="yan-panel" id="yanPanel">
      <ul>
        <li><a href="#" onclick="icerikYukle('kayit')">➕ Talebe Kayıt Et</a></li>
        <li><a href="#" onclick="icerikYukle('liste')">📄 Talebe Listesi</a></li>
        <li><a href="#" onclick="icerikYukle('bilgi')">📝 Talebe Bilgi Formu</a></li>
        <li><a href="#" onclick="icerikYukle('okul')">🏫 Talebe Okul Durumu</a></li>
      </ul>
      <!-- MOBİL ÇIKIŞ BUTONU -->
      <div class="mobil cikis-alani">
        <button class="cikis-buton" onclick="cikisYap()">Çıkış Yap</button>
      </div>
    </nav>

    <!-- İÇERİK PANELİ -->
    <main class="icerik-paneli" id="icerik-paneli">
      <h2>📄 Talebe Listesi</h2>
      <p>Sol menüden bir seçenek seçerek ilgili verileri burada görebilirsiniz.</p>
    </main>
  </div>
</body>
</html>
